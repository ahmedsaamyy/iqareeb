
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <link rel="stylesheet" href="style.css">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js', { updateViaCache: 'none' })
                    .then((registration) => {
                        // فحص التحديث كل ساعة
                        setInterval(() => {
                            registration.update();
                        }, 3600000);

                        console.log('SW registered: ', registration);

                        // عند اكتشاف تحديث
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showUpdateNotification(); // ✅ يظهر فقط لو فيه نسخة سابقة
                                }
                            });
                        });
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });

                // استقبال الرسائل من service worker
                navigator.serviceWorker.addEventListener('message', (event) => {
                    if (event.data && event.data.type === 'UPDATE_AVAILABLE') {
                        if (navigator.serviceWorker.controller) {
                            showUpdateNotification(); // ✅ تأكيد إضافي
                        }
                    }
                });
            });
        }

        // دالة إظهار إشعار التحديث
        function showUpdateNotification() {
            if (document.getElementById('updateNotification')) return;

            const updateNotification = document.createElement('div');
            updateNotification.className = 'update-notification';
            updateNotification.id = 'updateNotification';
            updateNotification.innerHTML = `
            <div class="update-content" style="
                background: #4CAF50;
                color: white;
                padding: 15px;
                text-align: center;
                font-weight: bold;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            ">
                <h3>تحديث التطبيق</h3>
                <p>يوجد إصدار جديد من التطبيق</p>
                <button id="update-button" class="btn" style="
                    margin-top: 10px;
                    padding: 8px 16px;
                    background: white;
                    color: #4CAF50;
                    font-weight: bold;
                    border: none;
                    border-radius: 5px;
                    cursor: pointer;
                ">تحديث الآن</button>
            </div>
        `;
            document.body.appendChild(updateNotification);

            document.getElementById('update-button').addEventListener('click', () => {
                navigator.serviceWorker.getRegistration().then(reg => {
                    if (reg.waiting) {
                        reg.waiting.postMessage({ type: 'SKIP_WAITING' });
                    }
                    window.location.reload();
                });
            });
        }

        // إصلاح لعناصر ID الفارغة (لو عندك استخدام له)
        window.addEventListener('DOMContentLoaded', function () {
            const elements = document.querySelectorAll('[id]');
            elements.forEach(el => {
                if (!el.textContent) {
                    el.textContent = '';
                }
            });
        });
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إني قريب</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3BAA57">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="إني قريب">
    <link rel="icon" href="icon-192.jpg">
    <link rel="apple-touch-icon" href="icon-192.jpg">

</head>
<body>

    <audio id="adhan-sound" src="azan.mp3" preload="auto"></audio>

    <!--<div id="updateNotification">
        يوجد تحديث جديد للتطبيق!
        <button onclick="updateApp()">تحديث الآن</button>
    </div>-->
    <div class="dark-mode-toggle">
        <div class="toggle" id="darkModeToggle" onclick="toggleDarkMode()">
            <div class="slider">
                <span class="toggle-icon sun">☀️</span>
                <span class="toggle-icon moon">🌙</span>
            </div>
        </div>
    </div>

    <div class="container">
        <section id="home" class="active">
            <header>
                <div class="header-hands">🤲</div>
                <div class="header-content">
                    <h1>إني قريب</h1>

                    <p>لتعزيز علاقتك بالله عز وجل✨</p>
                </div>
                <!--الترايخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخخ-->

            </header>
            <div class="install-prompt" id="install-prompt">
                <h3>📱 ثبت التطبيق على جهازك</h3>
                <p>للوصول السريع والعمل بدون إنترنت</p>
                <button class="btn" id="install-btn" style="background: white; color: var(--primary-color); margin: 10px;">تثبيت الآن</button>
                <button class="btn" onclick="hideInstallPrompt()" style="background: rgba(255,255,255,0.2);">إخفاء</button>
            </div>
            <div id="today-date" class="today-date"></div>
            <div class="card">
                <div class="quote-box" id="daily-quote">
                    "كل عمل صالح تقوم به اليوم هو استثمار في آخرتك، فاجعل يومك مليئاً بالخير"
                </div>
            </div>

            <h3>الأقسام الرئيسية</h3>
            <button class="btn btn-large" onclick="showSection('prayers')">🕋 الصلوات اليومية</button>
            <button class="btn btn-large" onclick="showSection('dhikr')">📿 التسبيح والعدادات</button>
            <button class="btn btn-large" onclick="showSection('new-adhkar')">🤲 الأذكار الشاملة</button>
            <button class="btn btn-large" onclick="showSection('quran-plans')">📖 خطط ختم القرآن</button>
            <button class="btn btn-large" onclick="showSection('ayat-kursi')">📖ايه الكرسي</button>
            <button class="btn btn-large" onclick="showSection('challenge')">🎯 التحدي اليومي</button>
            <button class="btn btn-large" onclick="showSection('stats')">📊 الإحصائيات اليومية</button>
            <button class="btn btn-large" onclick="showSection('release')">🧘 تفريغ الطاقات السلبية</button>
            <button class="btn btn-large" onclick="showSection('qibla')">🧭 بوصلة القبلة</button>

            <div class="card" style="margin-top: 30px;">
                <p style="text-align: center; margin-bottom: 15px;">
                    <strong>تصميم وتطوير: <a href="https://asamy.netlify.app" target="_blank" style="color: var(--primary-color);">أحمد سامي</a> ❤</strong>
                </p>
                <!--<p style="text-align: center; margin-bottom: 15px; font-weight: bold;">لو عندك أي تعديل أو إضافة أو مشكلة تواصل معي:</p>-->
                <div class="social-links">
                    <a href="https://wa.me/+201154939027" target="_blank" class="social-link">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
                        <div class="social-tooltip">تواصل عبر واتساب</div>
                    </a>
                    <a href="https://www.instagram.com/ahmed_saamy1" target="_blank" class="social-link">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Instagram">
                        <div class="social-tooltip">تابعني على انستجرام</div>
                    </a>
                    <a href="https://www.facebook.com/share/1C4c6CxGZw/" target="_blank" class="social-link">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="Facebook">
                        <div class="social-tooltip">تواصل عبر فيسبوك</div>
                    </a>
                    <a href="mailto:a.sami.devx@gmail.com" target="_blank" class="social-link">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/7/7e/Gmail_icon_%282020%29.svg" alt="Gmail">
                        <div class="social-tooltip">راسلني على الجيميل</div>
                    </a>
                </div>
            </div>
        </section>

        <!-- قسم الأذكار الشاملة الجديد -->
        <section id="new-adhkar">
            <h2>الأذكار الشاملة</h2>
            <p style="text-align: center; margin-bottom: 20px; color: var(--primary-color); font-weight: 600;">
                اختر نوع الأذكار
            </p>

            <div class="adhkar-category-grid" id="adhkar-categories-container">
                <!-- سيتم إضافة فئات الأذكار هنا بواسطة JavaScript -->
            </div>
        </section>

        <!-- صفحات تفاصيل الأذكار -->
        <section id="adhkar-morning" class="adhkar-detail-section">
            <div class="adhkar-detail-header">
                <button class="adhkar-detail-back" onclick="showSection('new-adhkar')">
                    <span>↩</span> العودة للأذكار
                </button>
                <div class="adhkar-detail-title">أذكار الصباح</div>
            </div>
            <div id="adhkar-morning-container">
                <!-- سيتم إضافة أذكار الصباح هنا بواسطة JavaScript -->
            </div>
        </section>

        <section id="adhkar-evening" class="adhkar-detail-section">
            <div class="adhkar-detail-header">
                <button class="adhkar-detail-back" onclick="showSection('new-adhkar')">
                    <span>↩</span> العودة للأذكار
                </button>
                <div class="adhkar-detail-title">أذكار المساء</div>
            </div>
            <div id="adhkar-evening-container">
                <!-- سيتم إضافة أذكار المساء هنا بواسطة JavaScript -->
            </div>
        </section>

        <section id="adhkar-prayer" class="adhkar-detail-section">
            <div class="adhkar-detail-header">
                <button class="adhkar-detail-back" onclick="showSection('new-adhkar')">
                    <span>↩</span> العودة للأذكار
                </button>
                <div class="adhkar-detail-title">أذكار بعد الصلاة</div>
            </div>
            <div id="adhkar-prayer-container">
                <!-- سيتم إضافة أذكار الصلاة هنا بواسطة JavaScript -->
            </div>
        </section>

        <section id="adhkar-sleep" class="adhkar-detail-section">
            <div class="adhkar-detail-header">
                <button class="adhkar-detail-back" onclick="showSection('new-adhkar')">
                    <span>↩</span> العودة للأذكار
                </button>
                <div class="adhkar-detail-title">أذكار النوم</div>
            </div>
            <div id="adhkar-sleep-container">
                <!-- سيتم إضافة أذكار النوم هنا بواسطة JavaScript -->
            </div>
        </section>

        <section id="adhkar-wakeup" class="adhkar-detail-section">
            <div class="adhkar-detail-header">
                <button class="adhkar-detail-back" onclick="showSection('new-adhkar')">
                    <span>↩</span> العودة للأذكار
                </button>
                <div class="adhkar-detail-title">أذكار الاستيقاظ</div>
            </div>
            <div id="adhkar-wakeup-container">
                <!-- سيتم إضافة أذكار الاستيقاظ هنا بواسطة JavaScript -->
            </div>
        </section>

        <section id="adhkar-home" class="adhkar-detail-section">
            <div class="adhkar-detail-header">
                <button class="adhkar-detail-back" onclick="showSection('new-adhkar')">
                    <span>↩</span> العودة للأذكار
                </button>
                <div class="adhkar-detail-title">أذكار المنزل</div>
            </div>
            <div id="adhkar-home-container">
                <!-- سيتم إضافة أذكار المنزل هنا بواسطة JavaScript -->
            </div>
        </section>

        <section id="adhkar-mosque" class="adhkar-detail-section">
            <div class="adhkar-detail-header">
                <button class="adhkar-detail-back" onclick="showSection('new-adhkar')">
                    <span>↩</span> العودة للأذكار
                </button>
                <div class="adhkar-detail-title">أذكار المسجد</div>
            </div>
            <div id="adhkar-mosque-container">
                <!-- سيتم إضافة أذكار المسجد هنا بواسطة JavaScript -->
            </div>
        </section>

        <section id="adhkar-travel" class="adhkar-detail-section">
            <div class="adhkar-detail-header">
                <button class="adhkar-detail-back" onclick="showSection('new-adhkar')">
                    <span>↩</span> العودة للأذكار
                </button>
                <div class="adhkar-detail-title">أذكار السفر</div>
            </div>
            <div id="adhkar-travel-container">
                <!-- سيتم إضافة أذكار السفر هنا بواسطة JavaScript -->
            </div>
        </section>

        <section id="adhkar-food" class="adhkar-detail-section">
            <div class="adhkar-detail-header">
                <button class="adhkar-detail-back" onclick="showSection('new-adhkar')">
                    <span>↩</span> العودة للأذكار
                </button>
                <div class="adhkar-detail-title">أذكار الطعام</div>
            </div>
            <div id="adhkar-food-container">
                <!-- سيتم إضافة أذكار الطعام هنا بواسطة JavaScript -->
            </div>
        </section>

        <section id="adhkar-distress" class="adhkar-detail-section">
            <div class="adhkar-detail-header">
                <button class="adhkar-detail-back" onclick="showSection('new-adhkar')">
                    <span>↩</span> العودة للأذكار
                </button>
                <div class="adhkar-detail-title">أذكار الهم والحزن</div>
            </div>
            <div id="adhkar-distress-container">
                <!-- سيتم إضافة أذكار الهم والحزن هنا بواسطة JavaScript -->
            </div>
        </section>

        <!-- قسم خطط ختم القرآن -->
        <section id="quran-plans">
            <h2>خطط ختم القرآن</h2>
            <p style="text-align: center; margin-bottom: 20px; color: var(--primary-color); font-weight: 600;">
                اختر خطة ختم القرآن المناسبة لك
            </p>

            <div class="quran-plans-grid">
                <div class="quran-plan-card" onclick="showQuranPlan('month')">
                    <div class="quran-plan-title">ختم في شهر</div>
                    <div class="quran-plan-description">جزء يومياً</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="month-plan-progress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="quran-plan-card" onclick="showQuranPlan('half-month')">
                    <div class="quran-plan-title">ختم في 15 يوم</div>
                    <div class="quran-plan-description">جزئين يومياً</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="half-month-plan-progress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="quran-plan-card" onclick="showQuranPlan('ten-days')">
                    <div class="quran-plan-title">ختم في 10 أيام</div>
                    <div class="quran-plan-description">3 أجزاء يومياً</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="ten-days-plan-progress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="quran-plan-card" onclick="showQuranPlan('week')">
                    <div class="quran-plan-title">ختم في أسبوع</div>
                    <div class="quran-plan-description">أكثر من 4 أجزاء يومياً</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="week-plan-progress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="quran-plan-card" onclick="showQuranPlan('two-months')">
                    <div class="quran-plan-title">ختم في شهرين</div>
                    <div class="quran-plan-description">نصف جزء يومياً</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="two-months-plan-progress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="quran-plan-card" onclick="showQuranPlan('custom')">
                    <div class="quran-plan-title">خطة مرنة</div>
                    <div class="quran-plan-description">حدد عدد الأيام أو الصفحات بنفسك</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="custom-plan-progress" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <a href="https://equran.org/index.html" target="_blank" class="quran-download-link">📖 فتح المصحف الشريف</a>
        </section>

        <!-- صفحات تفاصيل خطط ختم القرآن -->
        <section id="quran-plan-month" class="quran-plan-detail-section">
            <div class="quran-plan-detail-header">
                <button class="quran-plan-detail-back" onclick="showSection('quran-plans')">
                    <span>↩</span> العودة للخطط
                </button>
                <div class="quran-plan-detail-title">ختم في شهر (جزء يومياً)</div>
            </div>

            <div class="quran-daily-progress">
                <div class="quran-daily-progress-title">تقدم اليوم</div>
                <div class="quran-daily-progress-description" id="month-plan-today">اقرأ الجزء الأول اليوم</div>
                <button class="quran-daily-progress-button" id="month-plan-button" onclick="markQuranDayComplete('month')">
                    تمّت قراءة اليوم
                </button>
            </div>

            <div class="quran-stats">
                <div class="quran-stat-item">
                    <div class="quran-stat-value" id="month-plan-completed">0</div>
                    <div class="quran-stat-label">أيام مكتملة</div>
                </div>
                <div class="quran-stat-item">
                    <div class="quran-stat-value" id="month-plan-remaining">30</div>
                    <div class="quran-stat-label">أيام متبقية</div>
                </div>
            </div>

            <div class="quran-notification" id="month-plan-notification">
                ابدأ رحلتك مع القرآن الكريم
            </div>
        </section>

        <section id="quran-plan-half-month" class="quran-plan-detail-section">
            <div class="quran-plan-detail-header">
                <button class="quran-plan-detail-back" onclick="showSection('quran-plans')">
                    <span>↩</span> العودة للخطط
                </button>
                <div class="quran-plan-detail-title">ختم في 15 يوم (جزئين يومياً)</div>
            </div>

            <div class="quran-daily-progress">
                <div class="quran-daily-progress-title">تقدم اليوم</div>
                <div class="quran-daily-progress-description" id="half-month-plan-today">اقرأ الجزء الأول والثاني اليوم</div>
                <button class="quran-daily-progress-button" id="half-month-plan-button" onclick="markQuranDayComplete('half-month')">
                    تمّت قراءة اليوم
                </button>
            </div>

            <div class="quran-stats">
                <div class="quran-stat-item">
                    <div class="quran-stat-value" id="half-month-plan-completed">0</div>
                    <div class="quran-stat-label">أيام مكتملة</div>
                </div>
                <div class="quran-stat-item">
                    <div class="quran-stat-value" id="half-month-plan-remaining">15</div>
                    <div class="quran-stat-label">أيام متبقية</div>
                </div>
            </div>

            <div class="quran-notification" id="half-month-plan-notification">
                ابدأ رحلتك مع القرآن الكريم
            </div>
        </section>

        <section id="quran-plan-ten-days" class="quran-plan-detail-section">
            <div class="quran-plan-detail-header">
                <button class="quran-plan-detail-back" onclick="showSection('quran-plans')">
                    <span>↩</span> العودة للخطط
                </button>
                <div class="quran-plan-detail-title">ختم في 10 أيام (3 أجزاء يومياً)</div>
            </div>

            <div class="quran-daily-progress">
                <div class="quran-daily-progress-title">تقدم اليوم</div>
                <div class="quran-daily-progress-description" id="ten-days-plan-today">اقرأ 3 أجزاء اليوم</div>
                <button class="quran-daily-progress-button" id="ten-days-plan-button" onclick="markQuranDayComplete('ten-days')">
                    تمّت قراءة اليوم
                </button>
            </div>

            <div class="quran-stats">
                <div class="quran-stat-item">
                    <div class="quran-stat-value" id="ten-days-plan-completed">0</div>
                    <div class="quran-stat-label">أيام مكتملة</div>
                </div>
                <div class="quran-stat-item">
                    <div class="quran-stat-value" id="ten-days-plan-remaining">10</div>
                    <div class="quran-stat-label">أيام متبقية</div>
                </div>
            </div>

            <div class="quran-notification" id="ten-days-plan-notification">
                ابدأ رحلتك مع القرآن الكريم
            </div>
        </section>

        <section id="quran-plan-week" class="quran-plan-detail-section">
            <div class="quran-plan-detail-header">
                <button class="quran-plan-detail-back" onclick="showSection('quran-plans')">
                    <span>↩</span> العودة للخطط
                </button>
                <div class="quran-plan-detail-title">ختم في أسبوع (أكثر من 4 أجزاء يومياً)</div>
            </div>

            <div class="quran-daily-progress">
                <div class="quran-daily-progress-title">تقدم اليوم</div>
                <div class="quran-daily-progress-description" id="week-plan-today">اقرأ 4-5 أجزاء اليوم</div>
                <button class="quran-daily-progress-button" id="week-plan-button" onclick="markQuranDayComplete('week')">
                    تمّت قراءة اليوم
                </button>
            </div>

            <div class="quran-stats">
                <div class="quran-stat-item">
                    <div class="quran-stat-value" id="week-plan-completed">0</div>
                    <div class="quran-stat-label">أيام مكتملة</div>
                </div>
                <div class="quran-stat-item">
                    <div class="quran-stat-value" id="week-plan-remaining">7</div>
                    <div class="quran-stat-label">أيام متبقية</div>
                </div>
            </div>

            <div class="quran-notification" id="week-plan-notification">
                ابدأ رحلتك مع القرآن الكريم
            </div>
        </section>

        <section id="quran-plan-two-months" class="quran-plan-detail-section">
            <div class="quran-plan-detail-header">
                <button class="quran-plan-detail-back" onclick="showSection('quran-plans')">
                    <span>↩</span> العودة للخطط
                </button>
                <div class="quran-plan-detail-title">ختم في شهرين (نصف جزء يومياً)</div>
            </div>

            <div class="quran-daily-progress">
                <div class="quran-daily-progress-title">تقدم اليوم</div>
                <div class="quran-daily-progress-description" id="two-months-plan-today">اقرأ نصف جزء اليوم</div>
                <button class="quran-daily-progress-button" id="two-months-plan-button" onclick="markQuranDayComplete('two-months')">
                    تمّت قراءة اليوم
                </button>
            </div>

            <div class="quran-stats">
                <div class="quran-stat-item">
                    <div class="quran-stat-value" id="two-months-plan-completed">0</div>
                    <div class="quran-stat-label">أيام مكتملة</div>
                </div>
                <div class="quran-stat-item">
                    <div class="quran-stat-value" id="two-months-plan-remaining">60</div>
                    <div class="quran-stat-label">أيام متبقية</div>
                </div>
            </div>

            <div class="quran-notification" id="two-months-plan-notification">
                ابدأ رحلتك مع القرآن الكريم
            </div>
        </section>

        <section id="quran-plan-custom" class="quran-plan-detail-section">
            <div class="quran-plan-detail-header">
                <button class="quran-plan-detail-back" onclick="showSection('quran-plans')">
                    <span>↩</span> العودة للخطط
                </button>
                <div class="quran-plan-detail-title">خطة مرنة</div>
            </div>

            <div class="quran-custom-plan">
                <div class="quran-custom-plan-title">إنشاء خطة مخصصة</div>
                <div class="quran-custom-plan-form">
                    <select id="custom-plan-type">
                        <option value="days">تحديد عدد الأيام</option>
                        <option value="pages">تحديد عدد الصفحات يومياً</option>
                    </select>
                    <input type="number" id="custom-plan-value" placeholder="أدخل العدد" min="1">
                    <button onclick="createCustomQuranPlan()">إنشاء الخطة</button>
                </div>
            </div>

            <div class="quran-daily-progress" id="custom-plan-progress-section" style="display: none;">
                <div class="quran-daily-progress-title">تقدم اليوم</div>
                <div class="quran-daily-progress-description" id="custom-plan-today">خطتك المخصصة</div>
                <button class="quran-daily-progress-button" id="custom-plan-button" onclick="markQuranDayComplete('custom')">
                    تمّت قراءة اليوم
                </button>
            </div>

            <div class="quran-stats" id="custom-plan-stats" style="display: none;">
                <div class="quran-stat-item">
                    <div class="quran-stat-value" id="custom-plan-completed">0</div>
                    <div class="quran-stat-label">أيام مكتملة</div>
                </div>
                <div class="quran-stat-item">
                    <div class="quran-stat-value" id="custom-plan-remaining">0</div>
                    <div class="quran-stat-label">أيام متبقية</div>
                </div>
            </div>

            <div class="quran-notification" id="custom-plan-notification">
                أنشئ خطتك المخصصة لختم القرآن
            </div>
        </section>
        <!--ايه الكرسييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييييي-->
        <section id="ayat-kursi" class="section ayat-kursi-section">
            <div class="card ayat-kursi-card">
                <div class="adhkar-detail-header">
                    <button class="adhkar-detail-back" onclick="showSection('main')">
                        ↩ العودة للرئيسية
                    </button>
                    <h2 class="adhkar-detail-title">آية الكرسي</h2>
                </div>
                <div class="adhkar-detail-item ayat-kursi-content">
                    <div class="ayat-kursi-text-box">
                        <p class="adhkar-detail-text">
                            اللَّهُ لَا إِلَٰهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ ۚ لَا تَأْخُذُهُ سِنَةٌ وَلَا نَوْمٌ ۚ لَهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الْأَرْضِ ۗ مَنْ ذَا الَّذِي يَشْفَعُ عِنْدَهُ إِلَّا بِإِذْنِهِ ۚ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ ۖ وَلَا يُحِيطُونَ بِشَيْءٍ مِنْ عِلْمِهِ إِلَّا بِمَا شَاءَ ۚ وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالْأَرْضَ ۖ وَلَا يَئُودُهُ حِفْظُهُمَا ۚ وَهُوَ الْعَلِيُّ الْعَظِيمُ
                        </p>
                    </div>
                    <div class="adhkar-detail-counter">
                        <span class="adhkar-detail-count ayat-kursi-count" id="ayatKursiCount">0</span>
                        <div class="ayat-kursi-buttons">
                            <button class="adhkar-detail-button ayat-kursi-increment" onclick="incrementAyatKursi()">قرات</button>
                            <button class="adhkar-detail-button btn-danger ayat-kursi-reset" onclick="resetAyatKursi()">إعادة تعيين</button>
                        </div>
                    </div>
                    <div class="adhkar-detail-total ayat-kursi-total" id="ayatKursiTotal">الإجمالي: 0</div>
                </div>
            </div>
            <div class="card ayat-kursi-benefits">
                <h3 class="ayat-kursi-benefits-title">فوائد آية الكرسي</h3>
                <div class="ayat-kursi-benefits-grid">
                    <div class="benefit-card">
                        <span class="benefit-icon">🛡️</span>
                        <p class="benefit-text">الحماية من الشيطان: من قرأها بعد كل صلاة لم ينله شيطان.</p>
                    </div>
                    <div class="benefit-card">
                        <span class="benefit-icon">🏡</span>
                        <p class="benefit-text">حراسة المنزل: قراءتها في البيت تحفظه من الشرور.</p>
                    </div>
                    <div class="benefit-card">
                        <span class="benefit-icon">😴</span>
                        <p class="benefit-text">راحة النوم: من قرأها قبل النوم حُفظ حتى يستيقظ.</p>
                    </div>
                    <div class="benefit-card">
                        <span class="benefit-icon">🌟</span>
                        <p class="benefit-text">بركة اليوم: قراءتها صباحًا ومساءً تجلب البركة والأمان.</p>
                    </div>
                    <div class="benefit-card">
                        <span class="benefit-icon">🕊️</span>
                        <p class="benefit-text">طمأنينة القلب: تزيل الخوف وتهدئ النفس.</p>
                    </div>
                    <div class="benefit-card">
                        <span class="benefit-icon">📖</span>
                        <p class="benefit-text">أعظم آية: تحتوي على أسماء الله الحسنى وصفاته العظيمة.</p>
                    </div>
                </div>
            </div>
            <script>
                let ayatKursiCount = parseInt(localStorage.getItem('ayatKursiCount') || '0');
                let ayatKursiTotal = parseInt(localStorage.getItem('ayatKursiTotal') || '0');

                function updateAyatKursiUI() {
                    document.getElementById('ayatKursiCount').textContent = ayatKursiCount;
                    document.getElementById('ayatKursiTotal').textContent = `الإجمالي: ${ayatKursiTotal}`;
                    // تحديث الإجمالي في الإحصائيات العامة
                    const totalStats = document.getElementById('ayatKursiTotalStats');
                    if (totalStats) totalStats.textContent = ayatKursiTotal;
                    // تحديث اليومي في الإحصائيات العامة
                    const dailyStats = document.getElementById('ayatKursiDailyStats');
                    if (dailyStats) dailyStats.textContent = ayatKursiCount;
                }

                updateAyatKursiUI();

                function incrementAyatKursi() {
                    ayatKursiCount++;
                    ayatKursiTotal++;
                    localStorage.setItem('ayatKursiCount', ayatKursiCount);
                    localStorage.setItem('ayatKursiTotal', ayatKursiTotal);
                    updateAyatKursiUI();
                }

                function resetAyatKursi() {
                    ayatKursiCount = 0;
                    localStorage.setItem('ayatKursiCount', ayatKursiCount);
                    updateAyatKursiUI();
                }

                function checkMidnightReset() {
                    const now = new Date();
                    const midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
                    const timeToMidnight = midnight - now;
                    setTimeout(() => {
                        ayatKursiCount = 0;
                        localStorage.setItem('ayatKursiCount', ayatKursiCount);
                        updateAyatKursiUI();
                        checkMidnightReset();
                    }, timeToMidnight);
                }

                checkMidnightReset();

                function showSection(sectionId) {
                    document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
                    document.getElementById(sectionId).classList.add('active');
                    updateAyatKursiUI();
                }
                //تحدث الازكاررررررررررررررررررررررررررررررررررررررررررر
            </script>
            <script>
                function resetNewAdhkarAtMidnight() {
                    const now = new Date();
                    const midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1);
                    const timeToMidnight = midnight - now;

                    setTimeout(() => {
                        // تصفير العدادات
                        Object.keys(userData.newAdhkar).forEach((categoryId) => {
                            const category = userData.newAdhkar[categoryId];
                            if (category && category.items) {
                                category.items.forEach((item) => {
                                    item.count = 0;
                                });
                            }
                        });

                        // تحديث الإحصائيات قبل الحفظ
                        updateStats();

                        saveUserData();     // حفظ البيانات بعد التحديث
                        resetNewAdhkarAtMidnight(); // جدولة لليوم اللي بعده
                    }, timeToMidnight);
                }

                resetNewAdhkarAtMidnight();
            </script>

        </section>
        <section id="prayers">
            <h2>الصلوات اليومية</h2>
            <div class="progress-container">
                <div class="progress-bar" id="prayer-progress"></div>
            </div>
            <p id="prayer-status">أديت <span id="prayer-count">0</span> من 5 صلوات اليوم</p>

            <div class="prayer-card" id="fajr-card">
                <div class="prayer-info">
                    <div class="prayer-details">
                        <span class="prayer-name">الفجر</span>
                        <span class="prayer-time" id="fajr-time">جاري التحميل...</span>
                    </div>
                    <button class="btn" id="fajr-btn" onclick="togglePrayer('fajr')">صليت</button>
                </div>
            </div>

            <div class="prayer-card" id="dhuhr-card">
                <div class="prayer-info">
                    <div class="prayer-details">
                        <span class="prayer-name">الظهر</span>
                        <span class="prayer-time" id="dhuhr-time">جاري التحميل...</span>
                    </div>
                    <button class="btn" id="dhuhr-btn" onclick="togglePrayer('dhuhr')">صليت</button>
                </div>
            </div>

            <div class="prayer-card" id="asr-card">
                <div class="prayer-info">
                    <div class="prayer-details">
                        <span class="prayer-name">العصر</span>
                        <span class="prayer-time" id="asr-time">جاري التحميل...</span>
                    </div>
                    <button class="btn" id="asr-btn" onclick="togglePrayer('asr')">صليت</button>
                </div>
            </div>

            <div class="prayer-card" id="maghrib-card">
                <div class="prayer-info">
                    <div class="prayer-details">
                        <span class="prayer-name">المغرب</span>
                        <span class="prayer-time" id="maghrib-time">جاري التحميل...</span>
                    </div>
                    <button class="btn" id="maghrib-btn" onclick="togglePrayer('maghrib')">صليت</button>
                </div>
            </div>

            <div class="prayer-card" id="isha-card">
                <div class="prayer-info">
                    <div class="prayer-details">
                        <span class="prayer-name">العشاء</span>
                        <span class="prayer-time" id="isha-time">جاري التحميل...</span>
                    </div>
                    <button class="btn" id="isha-btn" onclick="togglePrayer('isha')">صليت</button>
                </div>
            </div>
            <div id="locationAlert" style="display: none; padding: 10px; background: rgba(255, 193, 7, 0.1); border: 1px solid #FFC107; border-radius: 8px; margin: 10px; text-align: center;">
                <span onclick="closeAlert()" style="cursor: pointer;">×</span>
                يرجى تفعيل الموقع لعرض أوقات الصلاة بدقة.
                <br>
                <span>⚠️ الأوقات المعروضة للقاهرة.</span>
            </div>
            <div class="card">
                <button type="button" class="collapsible">السنن الرواتب اليومية 📖</button>
                <div class="content">
                    <table style="width: 100%; border-collapse: collapse; margin: 15px 0;">
                        <tr style="background-color: var(--light-primary);">
                            <th style="padding: 10px; text-align: right;">الصلاة المفروضة</th>
                            <th style="padding: 10px; text-align: right;">السنة قبلها</th>
                            <th style="padding: 10px; text-align: right;">السنة بعدها</th>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">الفجر</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">✅ ركعتان مؤكدتان</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">❌ لا سنة بعدها</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">الظهر</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">✅ 4 ركعات (2 + 2)</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">✅ ركعتان</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">العصر</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">❌ لا سنة مؤكدة</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">❌ لا سنة بعدها</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">المغرب</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">❌ لا سنة قبلها</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">✅ ركعتان</td>
                        </tr>
                        <tr>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">العشاء</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">❌ لا سنة قبلها</td>
                            <td style="padding: 10px; border-bottom: 1px solid #eee;">✅ ركعتان</td>
                        </tr>
                    </table>
                    <div style="padding: 10px; background-color: rgba(59, 170, 87, 0.1); border-radius: 8px; margin-top: 10px;">
                        <p><strong>🌙 ملاحظات إضافية:</strong></p>
                        <ul style="padding-right: 15px;">
                            <li>سنة الفجر من أعظم السنن، وكان النبي ﷺ لا يتركها أبدًا.</li>
                            <li>لا توجد سنة راتبة للعصر، لكن من صلّى قبله تطوعًا فلا بأس.</li>
                            <li>يمكنك صلاة الوتر بعد العشاء (ليست من الرواتب ولكنها سنة مؤكدة).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section id="dhikr">
            <h2>التسبيح والعدادات</h2>

            <div id="dhikr-container">
            </div>

            <div class="card">
                <h3>إضافة تسبيح جديد</h3>
                <div class="custom-dhikr-form">
                    <input type="text" id="new-dhikr-text" placeholder="أدخل نص التسبيح هنا..." />
                    <button class="btn" onclick="addCustomDhikr()">إضافة</button>
                </div>
            </div>
        </section>

        <section id="challenge">
            <h2>التحدي اليومي</h2>

            <div class="card">
                <h3 id="challenge-title">تحدي اليوم</h3>
                <p id="challenge-description">وصف التحدي</p>
                <div class="progress-container">
                    <div class="progress-bar" id="challenge-progress"></div>
                </div>
                <button class="btn btn-large" id="challenge-btn" onclick="toggleChallenge()">أنجزت التحدي ✓</button>
            </div>

            <div class="card">
                <h3>تحديات سابقة</h3>
                <ul id="previous-challenges">
                </ul>
            </div>
        </section>

        <section id="stats">
            <h2>الإحصائيات اليومية</h2>

            <div class="card">
                <div class="stats-grid">
                    <div class="stats-item">
                        <div class="stats-value" id="stats-prayers">0/5</div>
                        <div class="stats-label">الصلوات</div>
                    </div>

                    <div class="stats-item">
                        <div class="stats-value" id="stats-dhikr">0</div>
                        <div class="stats-label">التسبيحات</div>
                    </div>

                    <!--<div class="stats-item">
                        <div class="stats-value" id="stats-adhkar">0</div>
                        <div class="stats-label">الأذكار</div>
                    </div>-->

                    <div class="stats-item">
                        <div class="stats-value" id="stats-quran">0</div>
                        <div class="stats-label">قراءة القرآن</div>
                    </div>

                    <div class="stats-item">
                        <div class="stats-value" id="stats-challenge">لا</div>
                        <div class="stats-label">التحدي</div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-value" id="ayatKursiDailyStats">0</div>
                        <div class="stats-label">آية الكرسي اليوم</div>
                    </div>
                </div>

                <div class="rating" id="daily-rating">
                    تقييم اليوم: محتاج تقرب أكتر
                </div>
            </div>

            <!--<div class="card">
                <h3>إحصائيات الأسبوع</h3>
                <div class="progress-container">
                    <div class="progress-bar" id="weekly-progress"></div>
                </div>
                <p>نسبة الإنجاز الأسبوعي: <span id="weekly-percentage">0%</span></p>
            </div>-->
            <!-- الإحصائيات العامة الجديدة -->
            <h2>الإحصائيات العامة</h2>
            <div class="card">

                <div class="stats-grid">
                    <div class="stats-item">
                        <div class="stats-value" id="total-prayers">0</div>
                        <div class="stats-label">إجمالي الصلوات</div>
                    </div>

                    <div class="stats-item">
                        <div class="stats-value" id="total-dhikr">0</div>
                        <div class="stats-label">إجمالي التسبيحات</div>
                    </div>

                    <div class="stats-item">
                        <div class="stats-value" id="total-adhkar">0</div>
                        <div class="stats-label">إجمالي الأذكار</div>
                    </div>

                    <div class="stats-item">
                        <div class="stats-value" id="total-quran-khatm">0</div>
                        <div class="stats-label">ختمات القرآن</div>
                    </div>

                    <div class="stats-item">
                        <div class="stats-value" id="total-challenges">0</div>
                        <div class="stats-label">إجمالي التحديات</div>
                    </div>
                    <div class="stats-item">
                        <div class="stats-value" id="ayatKursiTotalStats">0</div>
                        <div class="stats-label">إجمالي آية الكرسي</div>
                    </div>
                </div>
            </div>
            <h2>إحصائيات الصلوات (آخر 10 أيام)</h2>

            <div class="chart-wrapper">

                <!-- إحصائيات الأعداد -->
                <div style="text-align: center; margin-bottom: 10px;">
                    <div style="color: white; margin: 5px 0;">
                        عدد الصلوات في آخر 10 أيام:
                        <span id="last10Total" style="color: #4CAF50; font-weight: bold;">0</span>
                    </div>

                </div>

                <div class="chart-inner">
                    <canvas id="prayerChart"></canvas>
                </div>

                <!-- زر عرض كل الأيام -->
                <button onclick="showFullChart()" style="margin-top: 10px; background-color: #4CAF50; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">
                    عرض كامل
                </button>
                <!-- الرسم البياني الكامل -->
                <div class="chart-inner" style="margin-top: 20px; display: none;" id="fullChartContainer">

                    <h2>إحصائيات الصلوات (كامل)</h2>
                    <div style="color: white;">
                        عدد الصلوات الكلي:
                        <span id="overallTotal" style="color: #4CAF50; font-weight: bold;">0</span>
                    </div>
                    <canvas id="fullPrayerChart"></canvas>

                </div>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        </section>

        <section id="release">
            <h2>تفريغ الطاقات السلبية</h2>

            <div class="card">
                <h3>اختر مشكلتك</h3>
                <p>اختر المشكلة التي تواجهها للحصول على نصيحة إسلامية مخصصة:</p>
                <div class="problem-grid">
                    <div class="problem-card" onclick="showProblemSolution('exam')">
                        .
                        <div class="problem-icon">📚</div>
                        <div class="problem-title">قلق الامتحانات</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('travel')">
                        <div class="problem-icon">✈️</div>
                        <div class="problem-title">السفر والغربة</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('worry')">
                        <div class="problem-icon">😰</div>
                        <div class="problem-title">الهم والحزن</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('work')">
                        <div class="problem-icon">💼</div>
                        <div class="problem-title">ضغوط العمل</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('family')">
                        <div class="problem-icon">👨‍👩‍👧‍👦</div>
                        <div class="problem-title">مشاكل عائلية</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('health')">
                        <div class="problem-icon">🏥</div>
                        <div class="problem-title">مشاكل صحية</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('money')">
                        <div class="problem-icon">💰</div>
                        <div class="problem-title">ضائقة مالية</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('marriage')">
                        <div class="problem-icon">💍</div>
                        <div class="problem-title">مشاكل الزواج</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('children')">
                        <div class="problem-icon">👶</div>
                        <div class="problem-title">تربية الأطفال</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('friends')">
                        <div class="problem-icon">👥</div>
                        <div class="problem-title">مشاكل الأصدقاء</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('depression')">
                        <div class="problem-icon">😔</div>
                        <div class="problem-title">الاكتئاب</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('anger')">
                        <div class="problem-icon">😡</div>
                        <div class="problem-title">الغضب</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('fear')">
                        <div class="problem-icon">😨</div>
                        <div class="problem-title">الخوف والقلق</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('loneliness')">
                        <div class="problem-icon">😞</div>
                        <div class="problem-title">الوحدة</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('sin')">
                        <div class="problem-icon">😢</div>
                        <div class="problem-title">الذنوب والمعاصي</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('guidance')">
                        <div class="problem-icon">🤲</div>
                        <div class="problem-title">طلب الهداية</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('death')">
                        <div class="problem-icon">💔</div>
                        <div class="problem-title">فقدان عزيز</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('job')">
                        <div class="problem-icon">🔍</div>
                        <div class="problem-title">البحث عن عمل</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('decision')">
                        <div class="problem-icon">🤔</div>
                        <div class="problem-title">اتخاذ قرار مهم</div>
                    </div>
                    <div class="problem-card" onclick="showProblemSolution('addiction')">
                        <div class="problem-icon">🚫</div>
                        <div class="problem-title">التخلص من عادة سيئة</div>
                    </div>
                </div>

                <div id="ai-response" style="display: none;">
                </div>
            </div>

            <div class="card">
                <h3>أو اكتب مشكلتك بنفسك</h3>
                <p>إذا لم تجد مشكلتك في القائمة أعلاه، اكتب ما يزعجك هنا:</p>
                <textarea id="release-text" placeholder="اكتب ما يزعجك هنا..."></textarea>
                <button class="btn btn-large" onclick="releaseNegativeEnergy()">تفريغ</button>
            </div>

            <div class="card">
                <h3>نصائح للتخلص من الطاقة السلبية</h3>
                <ul>
                    <li>الوضوء يطفئ نار الغضب</li>
                    <li>قراءة القرآن تهدئ النفس</li>
                    <li>الاستغفار يزيل الهم والحزن</li>
                    <li>الصلاة على النبي ﷺ تشرح الصدر</li>
                    <li>الصدقة تدفع البلاء</li>
                </ul>
            </div>
        </section>

        <!-- قسم البوصلة -->
        <section id="qibla">
            <h2>بوصلة القبلة</h2>
            <div class="card compass-container">
                <div class="compass-canvas-container" id="compass-container">
                    <canvas id="compass-canvas" width="300" height="300" style="border-radius: 50%;"></canvas>
                </div>
                <div class="compass-info">
                    <div class="compass-direction" id="device-direction">
                        الاتجاه الحالي: --
                    </div>
                    <div class="compass-qibla" id="qibla-direction">
                        القبلة: -- | --
                    </div>
                    <div class="compass-coordinates" id="coordinates">
                        الإحداثيات: جاري التحميل...
                    </div>
                </div>
                <div class="compass-warning">
                    ⚠️ قد يكون اتجاه القبلة غير دقيق أحياناً بسبب الموقع الجغرافي.
                </div>
                <div class="compass-buttons">
                    <button class="btn" onclick="requestLocationPermission()">تفعيل الموقع</button>
                    <button class="btn btn-light" onclick="showSection('home')">العودة للرئيسية</button>
                </div>
            </div>
        </section>

        <section id="settings">
            <h2>الإعدادات</h2>

            <div class="card settings-card">
                <h3>إعدادات الصوت والاهتزاز</h3>

                <div class="settings-item">
                    <span>تفعيل الأصوات🔊</span>
                    <div class="toggle-switch" id="sound-toggle" onclick="toggleSoundFast()"></div>
                </div>

                <div class="settings-item">
                    <span>تفعيل الاهتزاز📳</span>
                    <div class="toggle-switch" id="vibration-toggle" onclick="toggleVibrationFast()"></div>
                </div>
                <div class="settings-item">
                    <span>تفعيل الأذان🕌</span>
                    <div class="toggle-switch" id="azan-toggle" onclick="toggleAzanSetting()"></div>

                </div>

                <div class="settings-item">
                    <span>تنبيهات أوقات الصلاة🔔</span>
                    <div class="toggle-switch" id="prayer-notifications-toggle" onclick="togglePrayerNotificationsFast()"></div>
                </div>
            </div>

            <div class="card settings-card">
                <h3>إعدادات التطبيق</h3>

                <!--<div class="update-app">
                    <span>تحديث التطبيق</span>
                    <button onclick="updateApp()">تحديث</button>
                </div>-->


                <div class="settings-item">
                    <span>تثبيت التطبيق</span>
                    <button class="btn" id="settings-install-btn" onclick="installApp()">تثبيت📱</button>
                </div>

                <button class="btn btn-large btn-danger" onclick="resetAllData()">🗑️ مسح جميع البيانات</button>
            </div>

            <div class="developer-info">
                <p>تصميم وتطوير بواسطة <a href="https://asamy.netlify.app" target="_blank">أحمد سامي</a></p>
                <!--<p style="text-align: center; margin-bottom: 15px; font-weight: bold;">لو عندك أي تعديل أو إضافة أو مشكلة تواصل معي:</p>-->
                <div class="social-links">
                    <a href="https://wa.me/+201154939027" target="_blank" class="social-link">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
                        <div class="social-tooltip">تواصل عبر واتساب</div>
                    </a>
                    <a href="https://www.instagram.com/ahmed_saamy1" target="_blank" class="social-link">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Instagram">
                        <div class="social-tooltip">تابعني على انستجرام</div>
                    </a>
                    <a href="https://www.facebook.com/share/1C4c6CxGZw/" target="_blank" class="social-link">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="Facebook">
                        <div class="social-tooltip">تواصل عبر فيسبوك</div>
                    </a>
                    <a href="mailto:a.sami.devx@gmail.com" target="_blank" class="social-link">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/7/7e/Gmail_icon_%282020%29.svg" alt="Gmail">
                        <div class="social-tooltip">راسلني على الجيميل</div>
                    </a>
                </div>
            </div>
        </section>
    </div>

    <div class="nav-container">
        <div class="nav">
            <div class="nav-item" onclick="showSection('home')" id="nav-home">
                <div class="nav-icon">🏠</div>
                <div>الرئيسية</div>
            </div>
            <div class="nav-item" onclick="showSection('prayers')" id="nav-prayers">
                <div class="nav-icon">🕋</div>
                <div>الصلوات</div>
            </div>
            <div class="nav-item" onclick="showSection('dhikr')" id="nav-dhikr">
                <div class="nav-icon">📿</div>
                <div>التسبيح</div>
            </div>
            <div class="nav-item" onclick="showSection('new-adhkar')" id="nav-adhkar">
                <div class="nav-icon">📖</div>
                <div>الأذكار</div>
            </div>
            <div class="nav-item" onclick="showSection('stats')" id="nav-stats">
                <div class="nav-icon">📊</div>
                <div>الإحصائيات</div>
            </div>
            <div class="nav-item" onclick="showSection('settings')" id="nav-settings">
                <div class="nav-icon">⚙️</div>
                <div>الإعدادات</div>
            </div>
        </div>
    </div>

    <!--باااااككككككككككككككككككككككككككككككككككككككككككككككككككككككككككككككككككككك-->
    <script type="module">
        console.log("🔥 Firebase script loaded");
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import {
            getFirestore,
            collection,
            addDoc,
            doc,
            getDoc,
            setDoc,
            updateDoc,
            getDocs,
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyArzeIp8l9SyedrXck1VfGgoXxWm6sRtNQ",
            authDomain: "iqsreeb.firebaseapp.com",
            projectId: "iqsreeb",
            storageBucket: "iqsreeb.firebasestorage.app",
            messagingSenderId: "857287419802",
            appId: "1:857287419802:web:370efb40e2e4ef987e3c23",
            measurementId: "G-ZHNRKLQJPK"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function getDeviceId() {
            let id = localStorage.getItem("deviceId");
            if (!id) {
                id = crypto.randomUUID();
                localStorage.setItem("deviceId", id);
            }
            return id;
        }

        // دالة للحصول على أعلى رقم ID ثابت موجود
        async function getNextFixedId() {
            try {
                const usersSnap = await getDocs(collection(db, "users"));
                let highestId = 50; // نبدأ من 50 كما طلبت

                usersSnap.forEach((docSnap) => {
                    const data = docSnap.data();
                    if (data.fixedId && data.fixedId > highestId) {
                        highestId = data.fixedId;
                    }
                });

                return highestId + 1;
            } catch (error) {
                console.error("Error getting next ID:", error);
                return 51; // قيمة افتراضية
            }
        }

        async function sendVisitData() {
            const timeNow = new Date().toISOString();
            const deviceId = getDeviceId();
            const userRef = doc(db, "users", deviceId);
            const localName = localStorage.getItem("userName") || "مجهول";

            async function sendData(lat, lng) {
                const docSnap = await getDoc(userRef);
                const oldData = docSnap.exists() ? docSnap.data() : {};
                const currentName = oldData.name;
                let finalName = localName;

                // ✅ الاسم في Firestore هو الأساس
                if (currentName && currentName !== "مجهول") {
                    finalName = currentName;
                    localStorage.setItem("userName", currentName);
                }

                // ✅ لو الاسم في Firestore مفقود أو مجهول، واسم المستخدم في localStorage حقيقي → نحفظه
                if ((!currentName || currentName === "مجهول") && localName !== "مجهول") {
                    finalName = localName;
                }

                const updates = {
                    lastVisit: timeNow,
                    lat: lat ?? oldData.lat ?? null,
                    lng: lng ?? oldData.lng ?? null,
                    visitCount: (oldData.visitCount || 0) + 1,
                    name: finalName
                };

                if (!docSnap.exists()) {
                    // مستخدم جديد - نعطيه ID ثابت
                    updates.deviceId = deviceId;
                    updates.fixedId = await getNextFixedId();
                    updates.firstVisit = timeNow;
                    await setDoc(userRef, updates);
                    console.log(`✅ New user created with fixed ID: ${updates.fixedId}`);
                } else {
                    // مستخدم قديم - إذا لم يكن له ID ثابت، نعطيه واحد
                    if (!oldData.fixedId) {
                        updates.fixedId = await getNextFixedId();
                        console.log(`✅ Assigned fixed ID to existing user: ${updates.fixedId}`);
                    }
                    await updateDoc(userRef, updates);
                }

                await addDoc(collection(db, "visits"), {
                    deviceId,
                    lat: updates.lat,
                    lng: updates.lng,
                    time: timeNow,
                });

                console.log("✅ Visit logged using deviceId:", deviceId);
            }

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        sendData(pos.coords.latitude, pos.coords.longitude);
                    },
                    (err) => {
                        console.warn("Location error:", err.message);
                        sendData(null, null);
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            } else {
                sendData(null, null);
            }
        }

        sendVisitData();
    </script>


    <script>

        //SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS
        //SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS
        //SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS
        //SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS
        //SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS
        //SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS
        //SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS
        //SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS
        //SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS





        // ========== إعدادات الأذان ==========
        function triggerAdhanNotification(prayerName) {
            const adhanAudio = document.getElementById("adhan-sound");

            adhanAudio.currentTime = 0;
            adhanAudio.play();

            if (Notification.permission === "granted") {
                new Notification(`🕌 حان الآن وقت صلاة ${getPrayerDisplayName(prayerName)}`, {
                    body: "أقم صلاتك 🙏",
                    icon: "icon-192.jpg"
                });
            }

            if (navigator.vibrate) {
                navigator.vibrate([300, 200, 300]);
            }
        }

        function getPrayerDisplayName(prayerKey) {
            const names = {
                fajr: "الفجر",
                dhuhr: "الظهر",
                asr: "العصر",
                maghrib: "المغرب",
                isha: "العشاء"
            };
            return names[prayerKey] || prayerKey;
        }
        function playAzanIfEnabled(prayerName) {
            const isEnabled = localStorage.getItem("azanEnabled") === "true";
            if (!isEnabled) return;

            if (document.visibilityState === "visible") {
                triggerAdhanNotification(prayerName); // صوت + إشعار
            } else {
                if (Notification.permission === "granted") {
                    new Notification(`🕌 حان الآن وقت صلاة ${getPrayerDisplayName(prayerName)}`, {
                        body: "أقم صلاتك 🙏",
                        icon: "icon-192.jpg"
                    });
                }
                if (navigator.vibrate) {
                    navigator.vibrate([300, 200, 300]);
                }
            }
        }


        function scheduleAzan(prayerName, timeStr) {
            const [hours, minutes] = timeStr.split(":").map(Number);
            const now = new Date();
            const azanTime = new Date();
            azanTime.setHours(hours, minutes, 0, 0);

            const delay = azanTime.getTime() - now.getTime();
            if (delay > 0) {
                setTimeout(() => {
                    const nowExact = new Date();
                    const nowTime = nowExact.getHours().toString().padStart(2, '0') + ":" +
                        nowExact.getMinutes().toString().padStart(2, '0');
                    const targetTime = hours.toString().padStart(2, '0') + ":" + minutes.toString().padStart(2, '0');

                    if (nowTime === targetTime) {
                        playAzanIfEnabled(prayerName);
                    }
                }, delay);
            }
        }

        function scheduleAllAzans(prayerTimes) {
            const prayers = {
                fajr: "Fajr",
                dhuhr: "Dhuhr",
                asr: "Asr",
                maghrib: "Maghrib",
                isha: "Isha"
            };

            Object.entries(prayers).forEach(([key, name]) => {
                const time = prayerTimes[name];
                if (time) scheduleAzan(key, time);
            });
        }

        function toggleAzanSetting() {
            const toggle = document.getElementById("azan-toggle");
            const isEnabled = localStorage.getItem("azanEnabled") === "true";

            if (isEnabled) {
                localStorage.setItem("azanEnabled", "false");
                toggle.classList.remove("enabled");
                console.log("❌ تم إيقاف الأذان");
            } else {
                Notification.requestPermission().then((permission) => {
                    if (permission === "granted") {
                        const audio = document.getElementById("adhan-sound");
                        audio.muted = true;
                        audio.play().then(() => {
                            audio.pause();
                            audio.currentTime = 0;
                            audio.muted = false;
                        });

                        if (userData.prayerTimes) {
                            scheduleAllAzans(userData.prayerTimes);
                        }

                        localStorage.setItem("azanEnabled", "true");
                        toggle.classList.add("enabled");
                        console.log("✅ تم تفعيل الأذان");
                    } else {
                        alert("لن تتمكن من استقبال الأذان بدون السماح بالإشعارات.");
                    }
                });
            }
        }


        function initAzanToggle() {
            const toggle = document.getElementById("azan-toggle");
            const isEnabled = localStorage.getItem("azanEnabled") === "true";
            if (isEnabled) {
                toggle.classList.add("enabled");
            } else {
                toggle.classList.remove("enabled");
            }
        }

        window.addEventListener("DOMContentLoaded", initAzanToggle);
        window.addEventListener("DOMContentLoaded", () => {
            initAzanToggle();

            if (localStorage.getItem("azanEnabled") === "true" && userData.prayerTimes) {
                scheduleAllAzans(userData.prayerTimes);
            }
        });

        //السنن
        //بتاع السنن
        const collapsibles = document.querySelectorAll(".collapsible");
        collapsibles.forEach(button => {
            button.addEventListener("click", () => {
                button.classList.toggle("active");
                const content = button.nextElementSibling;
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                }
            });
        });
        // طلب إذن الإشعارات
        async function requestNotificationPermission() {
            if ('Notification' in window && 'serviceWorker' in navigator) {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    console.log('تم السماح بالإشعارات');
                    return true;
                }
            }
            return false;
        }

        // إرسال إشعار الصلاة
        function sendPrayerNotification(prayerName, prayerTime) {
            if (!userData.settings.prayerNotifications) return;

            if ('serviceWorker' in navigator && Notification.permission === 'granted') {
                navigator.serviceWorker.ready.then(registration => {
                    registration.showNotification('حان وقت الصلاة', {
                        body: `حان الآن وقت صلاة ${prayerName} - ${prayerTime}`,
                        icon: '/icon-192.jpg',
                        badge: '/icon-192.jpg',
                        vibrate: [300, 100, 300],
                        tag: 'prayer-time',
                        actions: [
                            {
                                action: 'pray',
                                title: 'صليت',
                                icon: '/icon-192.jpg'
                            },
                            {
                                action: 'remind',
                                title: 'ذكرني لاحقاً'
                            }
                        ]
                    });
                });
            }
        }

        // فحص وقت الصلاة الحالي
        function checkCurrentPrayerTime() {
            if (!userData.prayerTimes) return;

            const now = new Date();
            const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

            const prayers = {
                'الفجر': userData.prayerTimes.Fajr,
                'الظهر': userData.prayerTimes.Dhuhr,
                'العصر': userData.prayerTimes.Asr,
                'المغرب': userData.prayerTimes.Maghrib,
                'العشاء': userData.prayerTimes.Isha
            };

            Object.entries(prayers).forEach(([name, time]) => {
                if (time === currentTime) {
                    sendPrayerNotification(name, formatTime(time));
                }
            });
        }
        const today = new Date().toLocaleDateString("ar-EG")
        let userData = {
            lastReset: today,
            prayers: {
                fajr: false,
                dhuhr: false,
                asr: false,
                maghrib: false,
                isha: false,
            },
            dhikr: {
                subhanallah: 0,
                alhamdulillah: 0,
                lailaha: 0,
                allahuakbar: 0,
                subhanallahwabihamdihi: 0,
                astaghfirullah: 0,
            },
            dhikrTotals: {
                subhanallah: 0,
                alhamdulillah: 0,
                lailaha: 0,
                allahuakbar: 0,
                subhanallahwabihamdihi: 0,
                astaghfirullah: 0,
            },
            customDhikr: {},
            newAdhkar: {},
            quranPlans: {
                month: { completed: 0, total: 30, dailyCompleted: false },
                "half-month": { completed: 0, total: 15, dailyCompleted: false },
                "ten-days": { completed: 0, total: 10, dailyCompleted: false },
                week: { completed: 0, total: 7, dailyCompleted: false },
                "two-months": { completed: 0, total: 60, dailyCompleted: false },
                custom: { completed: 0, total: 0, dailyCompleted: false, type: "", value: 0 },
            },
            challenge: {
                completed: false,
                history: [],
                currentChallengeIndex: 0,
                userSeed: Math.random(),
            },
            weeklyProgress: [0, 0, 0, 0, 0, 0, 0],
            totalStats: {
                prayers: 0,
                dhikr: 0,
                adhkar: 0,
                challenges: 0,
                quranKhatm: 0,
            },
            settings: {
                soundEnabled: true,
                vibrationEnabled: true,
                prayerNotifications: true,
                darkMode: false,
            },
            prayerTimes: null,
            location: null,
            version: "1.5.0",
        }

        // بيانات الأذكار الشاملة مع الأذكار الجديدة
        const adhkarCategories = [
            {
                id: "morning",
                title: "أذكار الصباح",
                icon: "🌅",
                content: [
                    {
                        text: "أعوذ بالله من الشيطان الرجيم\nالله لا إلـه إلا هو الحي القيوم لا تأخذه سنة ولا نوم له ما في السماوات وما في الأرض من ذا الذي يشفع عنده إلا بإذنه يعلم ما بين أيديهم وما خلفهم ولا يحيطون بشيء من علمه إلا بما شاء وسع كرسيه السماوات والأرض ولا يؤوده حفظهما وهو العلي العظيم. [آية الكرسى - البقرة 255].\nمن قالها حين يصبح أجير من الجن حتى يمسى ومن قالها حين يمسى أجير من الجن حتى يصبح.",
                        repeat: "1 مرة",
                    },
                    {
                        text: "بسم الله الرحمن الرحيم\nقل هو ٱلله أحد، ٱلله ٱلصمد، لم يلد ولم يولد، ولم يكن لهۥ كفوا أحدۢ.\nمن قالها حين يصبح وحين يمسى كفته من كل شىء (الإخلاص والمعوذتين).",
                        repeat: "3 مرات",
                    },
                    {
                        text: "بسم الله الرحمن الرحيم\nقل أعوذ برب ٱلفلق، من شر ما خلق، ومن شر غاسق إذا وقب، ومن شر ٱلنفٰثٰت فى ٱلعقد، ومن شر حاسد إذا حسد.",
                        repeat: "3 مرات",
                    },
                    {
                        text: "بسم الله الرحمن الرحيم\nقل أعوذ برب ٱلناس، ملك ٱلناس، إلٰه ٱلناس، من شر ٱلوسواس ٱلخناس، ٱلذى يوسوس فى صدور ٱلناس، من ٱلجنة وٱلناس.",
                        repeat: "3 مرات",
                    },
                    {
                        text: "أصـبحنا وأصـبح المـلك لله والحمد لله ، لا إله إلا الله وحده لا شريك له، له المـلك وله الحمـد، وهو على كل شيء قدير ، رب أسـألـك خـير ما في هـذا اليوم وخـير ما بعـده ، وأعـوذ بك من شـر ما في هـذا اليوم وشر ما بعـده، رب أعـوذبك من الكسـل وسـوء الكـبر ، رب أعـوذ بك من عـذاب في النـار وعـذاب في القـبر.",
                        repeat: "1 مرة",
                    },
                    {
                        text: "اللهـم أنت ربـي لا إله إلا أنت ، خلقتنـي وأنا عبـدك ، وأنا علـى عهـدك ووعـدك ما استـطعـت ، أعـوذبك من شـر ما صنـعت ، أبـوء لـك بنعـمتـك علـي وأبـوء بذنـبي فاغفـر لي فإنـه لا يغـفر الذنـوب إلا أنت .\nمن قالها موقنا بها حين يمسى ومات من ليلته دخل الجنة وكذلك حين يصبح.",
                        repeat: "1 مرة",
                    },
                    {
                        text: "رضيـت بالله ربـا وبالإسلام ديـنا وبمحـمد صلى الله عليه وسلم نبيـا.\nمن قالها حين يصبح وحين يمسى كان حقا على الله أن يرضيه يوم القيامة.",
                        repeat: "3 مرات",
                    },
                    {
                        text: "اللهـم إنـي أصبـحت أشـهدك ، وأشـهد حملـة عـرشـك ، وملائكتك ، وجمـيع خلـقك ، أنـك أنـت الله لا إله إلا أنـت وحـدك لا شريك لـك ، وأن محمـدا عبـدك ورسـولـك.\nمن قالها أعتقه الله من النار.",
                        repeat: "4 مرات",
                    },
                    {
                        text: "اللهـم ما أصبـح بي مـن نعـمة أو بأحـد مـن خلـقك ، فمـنك وحـدك لا شريك لـك ، فلـك الحمـد ولـك الشكـر.\nمن قالها حين يصبح أدى شكر يومه.",
                        repeat: "1 مرة",
                    },
                    {
                        text: "حسبـي الله لا إله إلا هو علـيه توكـلت وهو رب العرش العظـيم.\nمن قالها كفاه الله ما أهمه من أمر الدنيا والأخرة.",
                        repeat: "7 مرات",
                    },
                    {
                        text: "بسـم الله الذي لا يضـر مع اسمـه شيء في الأرض ولا في السمـاء وهـو السمـيع العلـيم.\nلم يضره من الله شيء.",
                        repeat: "3 مرات",
                    },
                    { text: "اللهـم بك أصـبحنا وبك أمسـينا ، وبك نحـيا وبك نمـوت وإلـيك النـشور.", repeat: "1 مرة" },
                    {
                        text: "أصبـحـنا على فطرة الإسلام، وعلى كلمة الإخلاص، وعلى دين نبينا محمد صلى الله عليه وسلم، وعلى ملة أبينا إبراهيم حنيفا مسلما وما كان من المشركين.",
                        repeat: "1 مرة",
                    },
                    { text: "سبحـان الله وبحمـده عدد خلـقه ، ورضـا نفسـه ، وزنـة عـرشـه ، ومـداد كلمـاتـه.", repeat: "3 مرات" },
                    {
                        text: "اللهـم عافـني في بدنـي ، اللهـم عافـني في سمـعي ، اللهـم عافـني في بصـري ، لا إله إلا أنـت.",
                        repeat: "3 مرات",
                    },
                    {
                        text: "اللهـم إنـي أعـوذ بك من الكـفر ، والفـقر ، وأعـوذ بك من عذاب القـبر ، لا إله إلا أنـت.",
                        repeat: "3 مرات",
                    },
                    {
                        text: "اللهـم إنـي أسـألـك العـفو والعـافـية في الدنـيا والآخـرة ، اللهـم إنـي أسـألـك العـفو والعـافـية في ديني ودنـياي وأهـلي ومالـي ، اللهـم استـر عـوراتي وآمـن روعاتـي ، اللهـم احفظـني من بـين يدي ومن خلفـي وعن يمـيني وعن شمـالي ، ومن فوقـي ، وأعـوذ بعظمـتك أن أغـتال من تحتـي.",
                        repeat: "1 مرة",
                    },
                    { text: "يا حي يا قيوم برحمتك أستغيث أصلح لي شأني كله ولا تكلني إلى نفسي طـرفة عين.", repeat: "3 مرات" },
                    {
                        text: "أصبـحـنا وأصبـح المـلك لله رب العـالمـين ، اللهـم إنـي أسـألـك خـير هـذا الـيوم ، فـتحه ، ونصـره ، ونـوره وبـركتـه ، وهـداه ، وأعـوذ بـك مـن شـر ما فـيه وشـر ما بعـده.",
                        repeat: "1 مرة",
                    },
                    {
                        text: "اللهـم عالـم الغـيب والشـهادة فاطـر السماوات والأرض رب كـل شـيء ومليـكه ، أشهـد أن لا إلـه إلا أنت ، أعـوذ بك من شـر نفسـي ومن شـر الشيـطان وشركه ، وأن أقتـرف علـى نفسـي سوءا أو أجـره إلـى مسـلم.",
                        repeat: "1 مرة",
                    },
                    { text: "أعـوذ بكلمـات الله التـامـات من شـر ما خلـق.", repeat: "3 مرات" },
                    {
                        text: "اللهم صل وسلم وبارك على نبينا محمد.\nمن صلى على حين يصبح وحين يمسى ادركته شفاعتى يوم القيامة.",
                        repeat: "10 مرات",
                    },
                    { text: "اللهم إنا نعوذ بك من أن نشرك بك شيئا نعلمه ، ونستغفرك لما لا نعلمه.", repeat: "3 مرات" },
                    {
                        text: "اللهم إني أعوذ بك من الهم والحزن، وأعوذ بك من العجز والكسل، وأعوذ بك من الجبن والبخل، وأعوذ بك من غلبة الدين، وقهر الرجال.",
                        repeat: "3 مرات",
                    },
                    { text: "أستغفر الله العظيم الذي لا إله إلا هو، الحي القيوم، وأتوب إليه.", repeat: "3 مرات" },
                    { text: "يا رب , لك الحمد كما ينبغي لجلال وجهك , ولعظيم سلطانك.", repeat: "3 مرات" },
                    { text: "اللهم إني أسألك علما نافعا، ورزقا طيبا، وعملا متقبلا.", repeat: "1 مرة" },
                    {
                        text: "اللهم أنت ربي لا إله إلا أنت ، عليك توكلت ، وأنت رب العرش العظيم , ما شاء الله كان ، وما لم يشأ لم يكن ، ولا حول ولا قوة إلا بالله العلي العظيم , أعلم أن الله على كل شيء قدير ، وأن الله قد أحاط بكل شيء علما , اللهم إني أعوذ بك من شر نفسي ، ومن شر كل دابة أنت آخذ بناصيتها ، إن ربي على صراط مستقيم.\nذكر طيب.",
                        repeat: "1 مرة",
                    },
                    {
                        text: "لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير.\nكانت له عدل عشر رقاب، وكتبت له مئة حسنة، ومحيت عنه مئة سيئة، وكانت له حرزا من الشيطان.",
                        repeat: "100 مرة",
                    },
                    {
                        text: "سبحـان الله وبحمـده.\nحطت خطاياه وإن كانت مثل زبد البحر. لم يأت أحد يوم القيامة بأفضل مما جاء به إلا أحد قال مثل ما قال أو زاد عليه.",
                        repeat: "100 مرة",
                    },
                    {
                        text: "أستغفر الله وأتوب إليه\nمائة حسنة، ومحيت عنه مائة سيئة، وكانت له حرزا من الشيطان حتى يمسى.",
                        repeat: "100 مرة",
                    },
                ],
            },
            {
                id: "evening",
                title: "أذكار المساء",
                icon: "🌇",
                content: [
                    {
                        text: "أعوذ بالله من الشيطان الرجيم\nالله لا إلـه إلا هو الحي القيوم لا تأخذه سنة ولا نوم له ما في السماوات وما في الأرض من ذا الذي يشفع عنده إلا بإذنه يعلم ما بين أيديهم وما خلفهم ولا يحيطون بشيء من علمه إلا بما شاء وسع كرسيه السماوات والأرض ولا يؤوده حفظهما وهو العلي العظيم. [آية الكرسى - البقرة 255].\nمن قالها حين يصبح أجير من الجن حتى يمسى ومن قالها حين يمسى أجير من الجن حتى يصبح.",
                        repeat: "1 مرة",
                    },
                    {
                        text: "أعوذ بالله من الشيطان الرجيم\nآمن الرسول بما أنزل إليه من ربه والمؤمنون ۚ كل آمن بالله وملائكته وكتبه ورسله لا نفرق بين أحد من رسله ۚ وقالوا سمعنا وأطعنا ۖ غفرانك ربنا وإليك المصير. لا يكلف الله نفسا إلا وسعها لها ما كسبت وعليها ما اكتسبت ربنا لا تؤاخذنا إن نسينآ أو أخطأنا ربنا ولا تحمل علينا إصرا كما حملته على الذين من قبلنا ربنا ولا تحملنا ما لا طاقة لنا به واعف عنا واغفر لنا وارحمنا أنت مولانا فانصرنا على القوم الكافرين. [البقرة 285 - 286].\nمن قرأ آيتين من آخر سورة البقرة في ليلة كفتاه.",
                        repeat: "1 مرة",
                    },
                    {
                        text: "بسم الله الرحمن الرحيم\nقل هو ٱلله أحد، ٱلله ٱلصمد، لم يلد ولم يولد، ولم يكن لهۥ كفوا أحدۢ.\nمن قالها حين يصبح وحين يمسى كفته من كل شىء (الإخلاص والمعوذتين).",
                        repeat: "3 مرات",
                    },
                    {
                        text: "بسم الله الرحمن الرحيم\nقل أعوذ برب ٱلفلق، من شر ما خلق، ومن شر غاسق إذا وقب، ومن شر ٱلنفٰثٰت فى ٱلعقد، ومن شر حاسد إذا حسد.",
                        repeat: "3 مرات",
                    },
                    {
                        text: "بسم الله الرحمن الرحيم\nقل أعوذ برب ٱلناس، ملك ٱلناس، إلٰه ٱلناس، من شر ٱلوسواس ٱلخناس، ٱلذى يوسوس فى صدور ٱلناس، من ٱلجنة وٱلناس.",
                        repeat: "3 مرات",
                    },
                    {
                        text: "أمسيـنا وأمسـى المـلك لله والحمد لله ، لا إله إلا الله وحده لا شريك له، له المـلك وله الحمـد، وهو على كل شيء قدير ، رب أسـألـك خـير ما في هـذه اللـيلة وخـير ما بعـدهـا ، وأعـوذ بك من شـر ما في هـذه اللـيلة وشر ما بعـدهـا ، رب أعـوذبك من الكسـل وسـوء الكـبر ، رب أعـوذ بك من عـذاب في النـار وعـذاب في القـبر.",
                        repeat: "1 مرة",
                    },
                    {
                        text: "اللهـم أنت ربـي لا إله إلا أنت ، خلقتنـي وأنا عبـدك ، وأنا علـى عهـدك ووعـدك ما استـطعـت ، أعـوذبك من شـر ما صنـعت ، أبـوء لـك بنعـمتـك علـي وأبـوء بذنـبي فاغفـر لي فإنـه لا يغـفر الذنـوب إلا أنت .\nمن قالها موقنا بها حين يمسى ومات من ليلته دخل الجنة وكذلك حين يصبح.",
                        repeat: "1 مرة",
                    },
                    {
                        text: "رضيـت بالله ربـا وبالإسلام ديـنا وبمحـمد صلى الله عليه وسلم نبيـا.\nمن قالها حين يصبح وحين يمسى كان حقا على الله أن يرضيه يوم القيامة.",
                        repeat: "3 مرات",
                    },
                    {
                        text: "اللهـم إنـي أمسيت أشـهدك ، وأشـهد حملـة عـرشـك ، وملائكتك ، وجمـيع خلـقك ، أنـك أنـت الله لا إله إلا أنـت وحـدك لا شريك لـك ، وأن محمـدا عبـدك ورسـولـك.\nمن قالها أعتقه الله من النار.",
                        repeat: "4 مرات",
                    },
                    {
                        text: "اللهـم ما أمسى بي مـن نعـمة أو بأحـد مـن خلـقك ، فمـنك وحـدك لا شريك لـك ، فلـك الحمـد ولـك الشكـر.\nمن قالها حين يمسى أدى شكر يومه.",
                        repeat: "1 مرة",
                    },
                    {
                        text: "حسبـي الله لا إله إلا هو علـيه توكـلت وهو رب العرش العظـيم.\nمن قالها كفاه الله ما أهمه من أمر الدنيا والأخرة.",
                        repeat: "7 مرات",
                    },
                    {
                        text: "بسـم الله الذي لا يضـر مع اسمـه شيء في الأرض ولا في السمـاء وهـو السمـيع العلـيم.\nلم يضره من الله شيء.",
                        repeat: "3 مرات",
                    },
                    { text: "اللهـم بك أمسـينا وبك أصـبحنا، وبك نحـيا وبك نمـوت وإلـيك المصير.", repeat: "1 مرة" },
                    {
                        text: "أمسينا على فطرة الإسلام، وعلى كلمة الإخلاص، وعلى دين نبينا محمد صلى الله عليه وسلم، وعلى ملة أبينا إبراهيم حنيفا مسلما وما كان من المشركين.",
                        repeat: "1 مرة",
                    },
                    { text: "سبحـان الله وبحمـده عدد خلـقه ، ورضـا نفسـه ، وزنـة عـرشـه ، ومـداد كلمـاتـه.", repeat: "3 مرات" },
                    {
                        text: "اللهـم عافـني في بدنـي ، اللهـم عافـني في سمـعي ، اللهـم عافـني في بصـري ، لا إله إلا أنـت.",
                        repeat: "3 مرات",
                    },
                    {
                        text: "اللهـم إنـي أعـوذ بك من الكـفر ، والفـقر ، وأعـوذ بك من عذاب القـبر ، لا إله إلا أنـت.",
                        repeat: "3 مرات",
                    },
                    {
                        text: "اللهـم إنـي أسـألـك العـفو والعـافـية في الدنـيا والآخـرة ، اللهـم إنـي أسـألـك العـفو والعـافـية في ديني ودنـياي وأهـلي ومالـي ، اللهـم استـر عـوراتي وآمـن روعاتـي ، اللهـم احفظـني من بـين يدي ومن خلفـي وعن يمـيني وعن شمـالي ، ومن فوقـي ، وأعـوذ بعظمـتك أن أغـتال من تحتـي.",
                        repeat: "1 مرة",
                    },
                    { text: "يا حي يا قيوم برحمتك أستغيث أصلح لي شأني كله ولا تكلني إلى نفسي طـرفة عين.", repeat: "3 مرات" },
                    {
                        text: "أمسينا وأمسى الملك لله رب العالمين، اللهم إني أسألك خير هذه الليلة ف، وخير ما فيها، وأعوذ بك من شرها، وشر ما فيها، اللهم إني أعوذ بك من الكسل، والهرم، وسوء الكبر، وفتنة الدنيا، وعذاب القبر.",
                        repeat: "1 مرة",
                    },
                    {
                        text: "اللهـم عالـم الغـيب والشـهادة فاطـر السماوات والأرض رب كـل شـيء ومليـكه ، أشهـد أن لا إلـه إلا أنت ، أعـوذ بك من شـر نفسـي ومن شـر الشيـطان وشركه ، وأن أقتـرف علـى نفسـي سوءا أو أجـره إلـى مسـلم.",
                        repeat: "1 مرة",
                    },
                    { text: "أعـوذ بكلمـات الله التـامـات من شـر ما خلـق.", repeat: "3 مرات" },
                    {
                        text: "اللهم صل وسلم وبارك على نبينا محمد.\nمن صلى على حين يصبح وحين يمسى ادركته شفاعتى يوم القيامة.",
                        repeat: "10 مرات",
                    },
                    { text: "اللهم إنا نعوذ بك من أن نشرك بك شيئا نعلمه ، ونستغفرك لما لا نعلمه.", repeat: "3 مرات" },
                    {
                        text: "اللهم إني أعوذ بك من الهم والحزن، وأعوذ بك من العجز والكسل، وأعوذ بك من الجبن والبخل، وأعوذ بك من غلبة الدين، وقهر الرجال.",
                        repeat: "3 مرات",
                    },
                    { text: "أستغفر الله العظيم الذي لا إله إلا هو، الحي القيوم، وأتوب إليه.", repeat: "3 مرات" },
                    { text: "يا رب , لك الحمد كما ينبغي لجلال وجهك , ولعظيم سلطانك.", repeat: "3 مرات" },
                    { text: "اللهم إني أسألك علما نافعا، ورزقا طيبا، وعملا متقبلا.", repeat: "1 مرة" },
                    {
                        text: "اللهم أنت ربي لا إله إلا أنت ، عليك توكلت ، وأنت رب العرش العظيم , ما شاء الله كان ، وما لم يشأ لم يكن ، ولا حول ولا قوة إلا بالله العلي العظيم , أعلم أن الله على كل شيء قدير ، وأن الله قد أحاط بكل شيء علما , اللهم إني أعوذ بك من شر نفسي ، ومن شر كل دابة أنت آخذ بناصيتها ، إن ربي على صراط مستقيم.\nذكر طيب.",
                        repeat: "1 مرة",
                    },
                    {
                        text: "لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير.\nكانت له عدل عشر رقاب، وكتبت له مئة حسنة، ومحيت عنه مئة سيئة، وكانت له حرزا من الشيطان.",
                        repeat: "100 مرة",
                    },
                    {
                        text: "سبحـان الله وبحمـده.\nحطت خطاياه وإن كانت مثل زبد البحر. لم يأت أحد يوم القيامة بأفضل مما جاء به إلا أحد قال مثل ما قال أو زاد عليه.",
                        repeat: "100 مرة",
                    },
                    {
                        text: "أستغفر الله وأتوب إليه\nمائة حسنة، ومحيت عنه مائة سيئة، وكانت له حرزا من الشيطان حتى يمسى.",
                        repeat: "100 مرة",
                    },
                ],
            },
            {
                id: "prayer",
                title: "أذكار بعد الصلاة",
                icon: "🕌",
                content: [
                    { text: "أستغفر الله", repeat: "3 مرات" },
                    { text: "اللهم أنت السلام ومنك السلام تباركت يا ذا الجلال والإكرام", repeat: "مرة واحدة" },
                    { text: "سبحان الله", repeat: "33 مرة" },
                    { text: "الحمد لله", repeat: "33 مرة" },
                    { text: "الله أكبر", repeat: "33 مرة" },
                    { text: "لا إله إلا الله وحده لا شريك له، له الملك وله الحمد وهو على كل شيء قدير", repeat: "مرة واحدة" },
                ],
            },
            {
                id: "sleep",
                title: "أذكار النوم",
                icon: "🌙",
                content: [
                    { text: "باسمك ربي وضعت جنبي وبك أرفعه", repeat: "مرة واحدة" },
                    { text: "اللهم قني عذابك يوم تبعث عبادك", repeat: "مرة واحدة" },
                    { text: "آية الكرسي", repeat: "مرة واحدة" },
                    { text: "سور: الإخلاص، الفلق، الناس", repeat: "3 مرات" },
                ],
            },
            {
                id: "wakeup",
                title: "أذكار الاستيقاظ",
                icon: "☀️",
                content: [{ text: "الحمد لله الذي أحيانا بعدما أماتنا وإليه النشور", repeat: "مرة واحدة" }],
            },
            {
                id: "home",
                title: "أذكار المنزل",
                icon: "🏠",
                content: [
                    { text: "دخول المنزل: بسم الله ولجنا، وبسم الله خرجنا، وعلى الله ربنا توكلنا", repeat: "مرة واحدة" },
                    { text: "الخروج من المنزل: بسم الله توكلت على الله، ولا حول ولا قوة إلا بالله", repeat: "مرة واحدة" },
                ],
            },
            {
                id: "mosque",
                title: "أذكار المسجد",
                icon: "🕌",
                content: [
                    { text: "دخول المسجد: اللهم افتح لي أبواب رحمتك", repeat: "مرة واحدة" },
                    { text: "الخروج من المسجد: اللهم إني أسألك من فضلك ورحمتك", repeat: "مرة واحدة" },
                ],
            },
            {
                id: "travel",
                title: "أذكار السفر",
                icon: "✈️",
                content: [
                    { text: "الله أكبر، الله أكبر، الله أكبر", repeat: "3 مرات" },
                    { text: "سبحان الذي سخر لنا هذا وما كنا له مقرنين وإنا إلى ربنا لمنقلبون", repeat: "مرة واحدة" },
                    { text: "اللهم إنا نسألك في سفرنا هذا البر والتقوى ومن العمل ما ترضى", repeat: "مرة واحدة" },
                ],
            },
            {
                id: "food",
                title: "أذكار الطعام",
                icon: "🍽️",
                content: [
                    { text: "قبل الأكل: بسم الله", repeat: "مرة واحدة" },
                    { text: "إذا نسي: بسم الله أوله وآخره", repeat: "مرة واحدة" },
                    { text: "بعد الأكل: الحمد لله الذي أطعمنا وسقانا وجعلنا من المسلمين", repeat: "مرة واحدة" },
                ],
            },
            {
                id: "distress",
                title: "أذكار الهم والحزن",
                icon: "😔",
                content: [
                    {
                        text: "لا إله إلا الله العظيم الحليم، لا إله إلا الله رب العرش العظيم، لا إله إلا الله رب السماوات ورب الأرض ورب العرش الكريم",
                        repeat: "مرة واحدة",
                    },
                    {
                        text: "اللهم إني أعوذ بك من الهم والحزن والعجز والكسل والجبن والبخل وغلبة الدين وقهر الرجال",
                        repeat: "مرة واحدة",
                    },
                ],
            },
        ]

        const defaultDhikrItems = [
            { id: "subhanallah", text: "سبحان الله" },
            { id: "alhamdulillah", text: "الحمد لله" },
            { id: "lailaha", text: "لا إله إلا الله" },
            { id: "allahuakbar", text: "الله أكبر" },
            { id: "subhanallahwabihamdihi", text: "سبحان الله وبحمده" },
            { id: "astaghfirullah", text: "أستغفر الله" },
        ]

        const dailyChallenges = [
            { title: "صلِّ على النبي ﷺ 100 مرة", description: "الصلاة على النبي ﷺ من أفضل الأعمال وأحبها إلى الله تعالى" },
            { title: "اقرأ سورة الفاتحة 10 مرات", description: "سورة الفاتحة أم الكتاب وأعظم سورة في القرآن" },
            { title: "سبح الله 100 مرة", description: "سبحان الله تملأ الميزان وتطهر القلب" },
            { title: "احمد الله 100 مرة", description: "الحمد لله رب العالمين، احمد الله على نعمه" },
            { title: "استغفر الله 100 مرة", description: "الاستغفار يمحو الذنوب ويجلب الرزق" },
            { title: "اقرأ آية الكرسي 10 مرات", description: "آية الكرسي سيدة آي القرآن" },
            { title: "ادع لوالديك 20 دعوة", description: "بر الوالدين من أعظم الأعمال عند الله" },
            { title: "تصدق بأي مبلغ", description: "الصدقة تطفئ غضب الرب وتدفع البلاء" },
            { title: "اقرأ سورة الإخلاص 33 مرة", description: "قل هو الله أحد تعدل ثلث القرآن" },
            { title: "اذكر الله 200 مرة", description: "ذكر الله طمأنينة للقلوب" },
        ]

        const dailyQuotes = [
            "كل عمل صالح تقوم به اليوم هو استثمار في آخرتك، فاجعل يومك مليئاً بالخير",
            "كل بني آدم خطاء، وخير الخطّائين التوّابون",
            "خيركم من تعلم القرآن وعلمه",
            "من قرأ حرفاً من كتاب الله فله به حسنة والحسنة بعشر أمثالها",
            "الطهور شطر الإيمان، والحمد لله تملأ الميزان",
            "من صام رمضان إيماناً واحتساباً غفر له ما تقدم من ذنبه",
            "من قام ليلة القدر إيماناً واحتساباً غفر له ما تقدم من ذنبه",
            "من حج البيت فلم يرفث ولم يفسق رجع كيوم ولدته أمه",
            "الصلوات الخمس، والجمعة إلى الجمعة، ورمضان إلى رمضان، مكفرات لما بينهن إذا اجتنبت الكبائر",
        ]

        const problemSolutions = {
            exam: {
                title: "قلق الامتحانات والدراسة",
                content: `
                                                                                            <p><strong>🌟 قال تعالى:</strong> "وَمَن يَتَّقِ اللَّهَ يَجْعَل لَّهُ مَخْرَجًا"</p>
                                                                                            <ul>
                                                                                                <li>📿 ادع بهذا الدعاء: "رَبِّ اشْرَحْ لِي صَدْرِي وَيَسِّرْ لِي أَمْرِي"</li>
                                                                                                <li>🤲 قل: "اللهم لا سهل إلا ما جعلته سهلاً وأنت تجعل الحزن إذا شئت سهلاً"</li>
                                                                                                <li>📖 اقرأ سورة طه قبل المذاكرة - تزيد التركيز</li>
                                                                                                <li>💧 توضأ قبل الدراسة - الوضوء ينشط الذهن</li>
                                                                                                <li>🌱 تذكر أن النجاح بيد الله، والسعي سبب</li>
                                                                                            </ul>
                                                                                            `,
            },
            travel: {
                title: "السفر والغربة",
                content: `
                                                                                            <p><strong>✈️ دعاء السفر:</strong> "سُبْحَانَ الَّذِي سَخَّرَ لَنَا هَٰذَا وَمَا كُنَّا لَهُ مُقْرِنِينَ"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع: "اللهم إني أسألك في سفري هذا البر والتقوى"</li>
                                                                                                <li>📿 أكثر من الاستغفار - يؤنس الوحشة</li>
                                                                                                <li>📖 اقرأ سورة الكهف يوم الجمعة - نور من النور</li>
                                                                                                <li>💝 تذكر أن الله معك أينما كنت</li>
                                                                                                <li>🌟 استغل الغربة في التقرب إلى الله</li>
                                                                                            </ul>
                                                                                            `,
            },
            worry: {
                title: "الهم والحزن",
                content: `
                                                                                            <p><strong>💙 قال النبي ﷺ:</strong> "ما أصاب عبداً هم ولا حزن فقال هذا الدعاء إلا أذهب الله همه"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع: "اللهم إني عبدك ابن عبدك ابن أمتك، ناصيتي بيدك، ماض في حكمك، عدل في قضاؤك، أسألك بكل اسم هو لك سميت به نفسك أو أنزلته في كتابك أو علمته أحداً من خلقك أو استأثرت به في علم الغيب عندك أن تجعل القرآن ربيع قلبي ونور صدري وجلاء حزني وذهاب همي"</li>
                                                                                                <li>📖 اقرأ سورة الشرح - تفرج الهموم</li>
                                                                                                <li>💧 توضأ وصل ركعتين</li>
                                                                                                <li>🌱 تذكر: "فَإِنَّ مَعَ الْعُسْرِ يُسْرًا"</li>
                                                                                            </ul>
                                                                                            `,
            },
            work: {
                title: "ضغوط العمل",
                content: `
                                                                                            <p><strong>💼 قال تعالى:</strong> "وَأَن لَّيْسَ لِلْإِنسَانِ إِلَّا مَا سَعَىٰ"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع: "اللهم بارك لي فيما رزقتني واكفني بحلالك عن حرامك"</li>
                                                                                                <li>📿 استغفر كثيراً - الاستغفار يجلب الرزق</li>
                                                                                                <li>💝 تصدق ولو بالقليل - الصدقة تدفع البلاء</li>
                                                                                                <li>🌟 اعمل بإتقان - "إن الله يحب إذا عمل أحدكم عملاً أن يتقنه"</li>
                                                                                                <li>⏰ نظم وقتك واجعل للعبادة نصيب</li>
                                                                                            </ul>
                                                                                            `,
            },
            family: {
                title: "المشاكل العائلية",
                content: `
                                                                                            <p><strong>👨‍👩‍👧‍👦 قال تعالى:</strong> "وَبِالْوَالِدَيْنِ إِحْسَانًا"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع: "رب اغفر لي ولوالدي وارحمهما كما ربياني صغيراً"</li>
                                                                                                <li>💝 تذكر فضائل بر الوالدين - الجنة تحت أقدام الأمهات</li>
                                                                                                <li>🕊️ اصبر على أذى الأقارب - لك أجر عظيم</li>
                                                                                                <li>🌸 صل رحمك ولو قطعوك</li>
                                                                                                <li>💬 تكلم بالحسنى واخفض جناح الذل</li>
                                                                                            </ul>
                                                                                            `,
            },
            health: {
                title: "المشاكل الصحية",
                content: `
                                                                                            <p><strong>🌿 قال تعالى:</strong> "وَإِذَا مَرِضْتُ فَهُوَ يَشْفِينِ"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع: "اللهم رب الناس أذهب البأس واشف أنت الشافي لا شفاء إلا شفاؤك شفاءً لا يغادر سقماً"</li>
                                                                                                <li>📖 اقرأ سورة الفاتحة على نفسك 7 مرات</li>
                                                                                                <li>🍯 استخدم العسل والحبة السوداء - شفاء من كل داء</li>
                                                                                                <li>💭 تذكر أن المرض يكفر الذنوب</li>
                                                                                                <li>🌱 اصبر واحتسب الأجر</li>
                                                                                            </ul>
                                                                                            `,
            },
            money: {
                title: "الضائقة المالية",
                content: `
                                                                                            <p><strong>💰 قال النبي ﷺ:</strong> "ليس الغنى عن كثرة العرض ولكن الغنى غنى النفس"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع: "اللهم اكفني بحلالك عن حرامك وأغنني بفضلك عمن سواك"</li>
                                                                                                <li>📿 أكثر من الاستغفار - يجلب الرزق</li>
                                                                                                <li>💝 تصدق من القليل - البركة في العطاء</li>
                                                                                                <li>🌟 اقنع بما قسم الله لك</li>
                                                                                                <li>🔄 تذكر أن الرزق مكتوب</li>
                                                                                            </ul>
                                                                                            `,
            },
            marriage: {
                title: "مشاكل الزواج",
                content: `
                                                                                            <p><strong>💍 قال تعالى:</strong> "وَمِنْ آيَاتِهِ أَنْ خَلَقَ لَكُم مِّنْ أَنفُسِكُمْ أَزْوَاجًا لِّتَسْكُنُوا إِلَيْهَا"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع: "اللهم أصلح لي ديني وأهلي"</li>
                                                                                                <li>💝 تذكر أن الزواج سكن ومودة</li>
                                                                                                <li>🕊️ اصبر وتحمل - الصبر مفتاح الفرج</li>
                                                                                                <li>💬 تواصل بالحسنى والكلمة الطيبة</li>
                                                                                                <li>🌸 ادع لشريك حياتك بالهداية</li>
                                                                                            </ul>
                                                                                            `,
            },
            children: {
                title: "تربية الأطفال",
                content: `
                                                                                            <p><strong>👶 قال النبي ﷺ:</strong> "كلكم راع وكلكم مسؤول عن رعيته"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع: "رب أوزعني أن أشكر نعمتك التي أنعمت علي"</li>
                                                                                                <li>📖 علمهم القرآن - خير ما يورث الآباء</li>
                                                                                                <li>💝 كن قدوة حسنة لهم</li>
                                                                                                <li>🌱 اصبر على تربيتهم - الصبر من الإيمان</li>
                                                                                                <li>🤲 ادع لهم بالهداية والصلاح</li>
                                                                                            </ul>
                                                                                            `,
            },
            friends: {
                title: "مشاكل الأصدقاء",
                content: `
                                                                                            <p><strong>🤝 قال النبي ﷺ:</strong> "المؤمن للمؤمن كالبنيان يشد بعضه بعضاً"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع للأصدقاء بظهر الغيب</li>
                                                                                                <li>💝 اختر الصحبة الصالحة</li>
                                                                                                <li>🌸 اعف عن الناس واصفح</li>
                                                                                                <li>🕊️ كن كما تحب أن يكون الناس معك</li>
                                                                                                <li>💬 تكلم بالحسنى وتجنب الغيبة</li>
                                                                                            </ul>
                                                                                            `,
            },
            depression: {
                title: "الاكتئاب والحزن الشديد",
                content: `
                                                                                            <p><strong>💙 قال تعالى:</strong> "أَلَا بِذِكْرِ اللَّهِ تَطْمَئِنُّ الْقُلُوبُ"</p>
                                                                                            <ul>
                                                                                                <li>📖 اقرأ سورة الضحى - نزلت لتواسي النبي ﷺ</li>
                                                                                                <li>🤲 ادع: "اللهم أذهب عني الهم والحزن والعجز والكسل"</li>
                                                                                                <li>💝 تذكر نعم الله عليك واحمده</li>
                                                                                                <li>🌸 اعلم أن الحزن امتحان وأجر</li>
                                                                                                <li>🔄 تذكر أن مع العسر يسراً</li>
                                                                                            </ul>
                                                                                            `,
            },
            anger: {
                title: "الغضب والانفعال",
                content: `
                                                                                            <p><strong>🔥 قال النبي ﷺ:</strong> "الوضوء يطفئ نار الغضب"</p>
                                                                                            <ul>
                                                                                                <li>💧 توضأ فوراً - هذا أول العلاج</li>
                                                                                                <li>🪑 اجلس إن كنت واقفاً، واستلق إن كنت جالساً</li>
                                                                                                <li>🤲 قل: "أعوذ بالله من الشيطان الرجيم"</li>
                                                                                                <li>💭 تذكر أن الغضب من الشيطان</li>
                                                                                                <li>🌱 اصبر واحتسب الأجر</li>
                                                                                            </ul>
                                                                                            `,
            },
            fear: {
                title: "الخوف والقلق",
                content: `
                                                                                            <p><strong>😨 قال تعالى:</strong> "وَمَن يَتَوَكَّلْ عَلَى اللَّهِ فَهُوَ حَسْبُهُ"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع: "حسبي الله لا إله إلا هو عليه توكلت وهو رب العرش العظيم"</li>
                                                                                                <li>📖 اقرأ آية الكرسي - تطرد الخوف</li>
                                                                                                <li>💝 تذكر أن الله معك</li>
                                                                                                <li>🌟 توكل على الله واتخذ الأسباب</li>
                                                                                                <li>🔄 تذكر أن القدر خير وشر</li>
                                                                                            </ul>
                                                                                            `,
            },
            loneliness: {
                title: "الوحدة والعزلة",
                content: `
                                                                                            <p><strong>😞 قال تعالى:</strong> "وَهُوَ مَعَكُمْ أَيْنَ مَا كُنتُمْ"</p>
                                                                                            <ul>
                                                                                                <li>📿 اذكر الله كثيراً - ذكر الله أنس</li>
                                                                                                <li>🤲 ادع: "اللهم آنس وحشتي واجبر كسرتي"</li>
                                                                                                <li>📖 اقرأ القرآن - خير جليس</li>
                                                                                                <li>🌱 تذكر أن الله معك دائماً</li>
                                                                                                <li>💝 اشغل وقتك بالطاعات</li>
                                                                                            </ul>
                                                                                            `,
            },
            sin: {
                title: "الذنوب والمعاصي",
                content: `
                                                                                            <p><strong>😢 قال تعالى:</strong> "وَمَن يَعْمَلْ سُوءًا أَوْ يَظْلِمْ نَفْسَهُ ثُمَّ يَسْتَغْفِرِ اللَّهَ يَجِدِ اللَّهَ غَفُورًا رَّحِيمًا"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع: "اللهم إنك عفو تحب العفو فاعف عني"</li>
                                                                                                <li>📿 أكثر من الاستغفار - يمحو الذنوب</li>
                                                                                                <li>💧 توضأ وصل ركعتين توبة</li>
                                                                                                <li>💝 تصدق - الصدقة تطفئ الخطيئة</li>
                                                                                                <li>🌱 اعزم على عدم العودة للذنب</li>
                                                                                            </ul>
                                                                                            `,
            },
            guidance: {
                title: "طلب الهداية",
                content: `
                                                                                            <p><strong>🤲 قال تعالى:</strong> "اهْدِنَا الصِّرَاطَ الْمُسْتَقِيمَ"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع: "اللهم اهدني فيمن هديت"</li>
                                                                                                <li>📖 اقرأ القرآن بتدبر</li>
                                                                                                <li>💝 اصحب الصالحين</li>
                                                                                                <li>🌟 اطلب العلم الشرعي</li>
                                                                                                <li>🔄 استمر في الدعاء والإلحاح</li>
                                                                                            </ul>
                                                                                            `,
            },
            death: {
                title: "فقدان عزيز",
                content: `
                                                                                            <p><strong>💔 قال النبي ﷺ:</strong> "إنا لله وإنا إليه راجعون، اللهم أجرني في مصيبتي واخلف لي خيراً منها"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع للميت: "اللهم اغفر له وارحمه وعافه واعف عنه"</li>
                                                                                                <li>💝 تذكر أن الموت حق على كل نفس</li>
                                                                                                <li>🌸 اصبر واحتسب الأجر</li>
                                                                                                <li>📖 اقرأ القرآن وأهد ثوابه للميت</li>
                                                                                                <li>💰 تصدق عن روح الميت</li>
                                                                                            </ul>
                                                                                            `,
            },
            job: {
                title: "البحث عن عمل",
                content: `
                                                                                            <p><strong>🔍 قال تعالى:</strong> "وَأَن لَّيْسَ لِلْإِنسَانِ إِلَّا مَا سَعَىٰ"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع: "اللهم يسر لي رزقاً حلالاً طيباً"</li>
                                                                                                <li>📿 استغفر كثيراً - الاستغفار يفتح أبواب الرزق</li>
                                                                                                <li>💝 تصدق ولو بالقليل</li>
                                                                                                <li>🌟 اسع واتخذ الأسباب</li>
                                                                                                <li>🔄 توكل على الله في النتائج</li>
                                                                                            </ul>
                                                                                            `,
            },
            decision: {
                title: "اتخاذ قرار مهم",
                content: `
                                                                                            <p><strong>🤔 قال النبي ﷺ:</strong> "إذا هم أحدكم بالأمر فليركع ركعتين من غير الفريضة"</p>
                                                                                            <ul>
                                                                                                <li>🤲 صل صلاة الاستخارة</li>
                                                                                                <li>📖 استشر أهل الخبرة والصلاح</li>
                                                                                                <li>💭 فكر في العواقب</li>
                                                                                                <li>🌟 توكل على الله بعد الاستخارة</li>
                                                                                                <li>🔄 ارض بما يقدره الله لك</li>
                                                                                            </ul>
                                                                                            `,
            },
            addiction: {
                title: "التخلص من عادة سيئة",
                content: `
                                                                                            <p><strong>🚫 قال تعالى:</strong> "وَمَن يَتَّقِ اللَّهَ يَجْعَل لَّهُ مَخْرَجًا"</p>
                                                                                            <ul>
                                                                                                <li>🤲 ادع: "اللهم أعني على ذكرك وشكرك وحسن عبادتك"</li>
                                                                                                <li>💧 حافظ على الوضوء والصلاة</li>
                                                                                                <li>💝 اشغل وقتك بالطاعات</li>
                                                                                                <li>🌟 اصحب الصالحين</li>
                                                                                                <li>🔄 استعن بالله واصبر</li>
                                                                                            </ul>
                                                                                            `,
            },
        }

        // خطط ختم القرآن
        const quranPlans = {
            month: {
                title: "ختم في شهر",
                description: "جزء يومياً",
                days: 30,
                dailyAmount: "جزء واحد",
            },
            "half-month": {
                title: "ختم في 15 يوم",
                description: "جزئين يومياً",
                days: 15,
                dailyAmount: "جزئين",
            },
            "ten-days": {
                title: "ختم في 10 أيام",
                description: "3 أجزاء يومياً",
                days: 10,
                dailyAmount: "3 أجزاء",
            },
            week: {
                title: "ختم في أسبوع",
                description: "أكثر من 4 أجزاء يومياً",
                days: 7,
                dailyAmount: "4-5 أجزاء",
            },
            "two-months": {
                title: "ختم في شهرين",
                description: "نصف جزء يومياً",
                days: 60,
                dailyAmount: "نصف جزء",
            },
        }

        let deferredPrompt
        let audioContext
        const dhikrTimeout = null
        let backButtonPressCount = 0
        let backButtonTimer = null

        // متغيرات البوصلة
        let compassCanvas
        let compassCtx
        let deviceHeading = 0
        let qiblaDirection = 0
        let userLocation = null

        // وظائف الأذكار الجديدة
        function initializeNewAdhkar() {
            adhkarCategories.forEach((category) => {
                if (!userData.newAdhkar[category.id]) {
                    userData.newAdhkar[category.id] = {
                        totalCount: 0,
                        items: {},
                    }
                }

                category.content.forEach((item, index) => {
                    if (!userData.newAdhkar[category.id].items[index]) {
                        userData.newAdhkar[category.id].items[index] = {
                            count: 0,
                            totalCount: 0,
                        }
                    }
                })
            })

            updateAdhkarCategoriesContainer()
        }

        function updateAdhkarCategoriesContainer() {
            const container = document.getElementById("adhkar-categories-container")
            if (!container) return

            let html = ""

            adhkarCategories.forEach((category) => {
                const categoryData = userData.newAdhkar[category.id] || { totalCount: 0 }

                html += `
                                                                                            <div class="adhkar-category-card" onclick="showAdhkarDetail('${category.id}')">
                                                                                                <div class="adhkar-category-icon">${category.icon}</div>
                                                                                                <div class="adhkar-category-title">${category.title}</div>
                                                                                                <div class="adhkar-category-count">${categoryData.totalCount}</div>
                                                                                            </div>
                                                                                            `
            })

            container.innerHTML = html
        }

        function showAdhkarDetail(categoryId) {
            const category = adhkarCategories.find((cat) => cat.id === categoryId)
            if (!category) return

            showSection(`adhkar-${categoryId}`)
            updateAdhkarDetailContainer(categoryId)
        }

        function updateAdhkarDetailContainer(categoryId) {
            const category = adhkarCategories.find((cat) => cat.id === categoryId)
            if (!category) return

            const container = document.getElementById(`adhkar-${categoryId}-container`)
            if (!container) return

            let html = ""

            category.content.forEach((item, index) => {
                const itemData = userData.newAdhkar[categoryId]?.items[index] || { count: 0, totalCount: 0 }

                html += `
                                                                                            <div class="adhkar-detail-item">
                                                                                                <div class="adhkar-detail-total">الإجمالي: ${itemData.totalCount}</div>
                                                                                                <div class="adhkar-detail-text">${item.text}</div>
                                                                                                <div class="adhkar-detail-repeat">${item.repeat}</div>
                                                                                                <div class="adhkar-detail-counter">
                                                                                                    <div class="adhkar-detail-count">${itemData.count}</div>
                                                                                                    <button class="adhkar-detail-button" onclick="incrementAdhkarItem('${categoryId}', ${index})">
                                                                                                        ذكرت
                                                                                                    </button>
                                                                                                </div>
                                                                                            </div>
                                                                                            `
            })

            container.innerHTML = html
        }

        function incrementAdhkarItem(categoryId, itemIndex) {
            if (!userData.newAdhkar[categoryId]) {
                userData.newAdhkar[categoryId] = { totalCount: 0, items: {} }
            }

            if (!userData.newAdhkar[categoryId].items[itemIndex]) {
                userData.newAdhkar[categoryId].items[itemIndex] = { count: 0, totalCount: 0 }
            }

            userData.newAdhkar[categoryId].items[itemIndex].count++
            userData.newAdhkar[categoryId].items[itemIndex].totalCount++
            userData.newAdhkar[categoryId].totalCount++
            userData.totalStats.adhkar++

            playFeedbackFast()
            updateAdhkarDetailContainer(categoryId)
            updateAdhkarCategoriesContainer()
            updateStats()
            saveUserData()
        }

        // وظائف خطط ختم القرآن
        function initializeQuranPlans() {
            // تحديث واجهة خطط ختم القرآن
            updateQuranPlansProgress()
        }

        function updateQuranPlansProgress() {
            Object.keys(quranPlans).forEach((planId) => {
                const progressBar = document.getElementById(`${planId}-plan-progress`)
                if (progressBar) {
                    const plan = userData.quranPlans[planId]
                    const percentage = plan.total > 0 ? Math.round((plan.completed / plan.total) * 100) : 0
                    progressBar.style.width = `${percentage}%`
                }
            })
        }

        function showQuranPlan(planId) {
            showSection(`quran-plan-${planId}`)
            updateQuranPlanDetails(planId)
        }

        function updateQuranPlanDetails(planId) {
            const plan = userData.quranPlans[planId]

            // تحديث عدد الأيام المكتملة والمتبقية
            const completedElement = document.getElementById(`${planId}-plan-completed`)
            const remainingElement = document.getElementById(`${planId}-plan-remaining`)
            const todayElement = document.getElementById(`${planId}-plan-today`)
            const buttonElement = document.getElementById(`${planId}-plan-button`)
            const notificationElement = document.getElementById(`${planId}-plan-notification`)

            if (completedElement) completedElement.textContent = plan.completed
            if (remainingElement) remainingElement.textContent = plan.total - plan.completed

            if (buttonElement) {
                if (plan.dailyCompleted) {
                    buttonElement.textContent = "تمت قراءة اليوم ✓"
                    buttonElement.classList.add("completed")
                } else {
                    buttonElement.textContent = "تمّت قراءة اليوم"
                    buttonElement.classList.remove("completed")
                }
            }

            if (todayElement) {
                if (planId === "custom" && plan.type) {
                    if (plan.type === "days") {
                        const pagesPerDay = Math.ceil(604 / plan.value) // 604 صفحة في المصحف
                        todayElement.textContent = `اقرأ ${pagesPerDay} صفحة اليوم`
                    } else if (plan.type === "pages") {
                        todayElement.textContent = `اقرأ ${plan.value} صفحة اليوم`
                    }
                } else if (quranPlans[planId]) {
                    const nextPart = plan.completed + 1
                    if (nextPart <= plan.total) {
                        todayElement.textContent = `اقرأ ${quranPlans[planId].dailyAmount} اليوم`
                    } else {
                        todayElement.textContent = "أكملت الختمة! يمكنك البدء من جديد"
                    }
                }
            }

            if (notificationElement) {
                if (plan.completed === 0) {
                    notificationElement.textContent = "ابدأ رحلتك مع القرآن الكريم"
                } else if (plan.completed === plan.total) {
                    notificationElement.textContent = "مبارك! لقد أكملت ختمة القرآن الكريم"
                } else {
                    const percentage = Math.round((plan.completed / plan.total) * 100)
                    notificationElement.textContent = `أنجزت ${percentage}% من خطة الختم`
                }
            }

            // إذا كانت الخطة المخصصة، نظهر أو نخفي أقسام معينة
            if (planId === "custom") {
                const progressSection = document.getElementById("custom-plan-progress-section")
                const statsSection = document.getElementById("custom-plan-stats")

                if (progressSection && statsSection) {
                    if (plan.total > 0) {
                        progressSection.style.display = "block"
                        statsSection.style.display = "grid"
                    } else {
                        progressSection.style.display = "none"
                        statsSection.style.display = "none"
                    }
                }
            }
        }

        function markQuranDayComplete(planId) {
            const plan = userData.quranPlans[planId]

            if (!plan.dailyCompleted && plan.completed < plan.total) {
                plan.dailyCompleted = true
                plan.completed++

                // إذا أكمل الختمة
                if (plan.completed === plan.total) {
                    userData.totalStats.quranKhatm++
                    showCelebration("🎉 مبارك! لقد أكملت ختمة القرآن الكريم")
                }

                playFeedbackFast()
                updateQuranPlanDetails(planId)
                updateQuranPlansProgress()
                updateStats()
                saveUserData()
            }
        }

        function createCustomQuranPlan() {
            const typeSelect = document.getElementById("custom-plan-type")
            const valueInput = document.getElementById("custom-plan-value")

            if (!typeSelect || !valueInput) return

            const type = typeSelect.value
            const value = Number.parseInt(valueInput.value)

            if (isNaN(value) || value <= 0) {
                alert("الرجاء إدخال قيمة صحيحة")
                return
            }

            // إعادة تعيين الخطة المخصصة
            userData.quranPlans.custom = {
                completed: 0,
                total: type === "days" ? value : Math.ceil(604 / value), // 604 صفحة في المصحف
                dailyCompleted: false,
                type: type,
                value: value,
            }

            updateQuranPlanDetails("custom")
            updateQuranPlansProgress()
            saveUserData()

            alert("تم إنشاء الخطة المخصصة بنجاح")
        }

        // وظائف البوصلة المحسنة
        function initializeCompass() {
            compassCanvas = document.getElementById("compass-canvas")
            if (!compassCanvas) return

            compassCtx = compassCanvas.getContext("2d")
            drawCompass()
        }

        function drawCompass() {
            if (!compassCtx) return

            const centerX = 150
            const centerY = 150
            const radius = 140

            compassCtx.clearRect(0, 0, 300, 300)

            // رسم الدائرة الخارجية
            compassCtx.beginPath()
            compassCtx.arc(centerX, centerY, radius, 0, 2 * Math.PI)
            compassCtx.strokeStyle = "#4CAF50"
            compassCtx.lineWidth = 3
            compassCtx.stroke()

            // رسم الاتجاهات الأساسية
            const directions = [
                { angle: 0, label: "N", color: "#FF4444" },
                { angle: 90, label: "E", color: "#FFFFFF" },
                { angle: 180, label: "S", color: "#FFFFFF" },
                { angle: 270, label: "W", color: "#FFFFFF" },
            ]

            directions.forEach((dir) => {
                const angle = ((dir.angle - 90) * Math.PI) / 180
                const x = centerX + Math.cos(angle) * (radius - 20)
                const y = centerY + Math.sin(angle) * (radius - 20)

                compassCtx.fillStyle = dir.color
                compassCtx.font = "bold 20px Arial"
                compassCtx.textAlign = "center"
                compassCtx.textBaseline = "middle"
                compassCtx.fillText(dir.label, x, y)
            })

            // رسم العلامات الدرجية
            for (let i = 0; i < 360; i += 30) {
                const angle = ((i - 90) * Math.PI) / 180
                const x1 = centerX + Math.cos(angle) * (radius - 10)
                const y1 = centerY + Math.sin(angle) * (radius - 10)
                const x2 = centerX + Math.cos(angle) * (radius - 25)
                const y2 = centerY + Math.sin(angle) * (radius - 25)

                compassCtx.beginPath()
                compassCtx.moveTo(x1, y1)
                compassCtx.lineTo(x2, y2)
                compassCtx.strokeStyle = "#FFFFFF"
                compassCtx.lineWidth = 2
                compassCtx.stroke()

                const textX = centerX + Math.cos(angle) * (radius - 35)
                const textY = centerY + Math.sin(angle) * (radius - 35)
                compassCtx.fillStyle = "#FFFFFF"
                compassCtx.font = "12px Arial"
                compassCtx.textAlign = "center"
                compassCtx.fillText(i.toString(), textX, textY)
            }

            drawDeviceArrow()

            if (qiblaDirection !== 0) {
                drawQiblaArrow()
            }
        }

        function drawDeviceArrow() {
            const centerX = 150
            const centerY = 150
            const angle = ((deviceHeading - 90) * Math.PI) / 180

            compassCtx.save()
            compassCtx.translate(centerX, centerY)
            compassCtx.rotate(angle)

            // رسم سهم الجهاز
            compassCtx.beginPath()
            compassCtx.moveTo(0, -80)
            compassCtx.lineTo(-10, -60)
            compassCtx.lineTo(10, -60)
            compassCtx.closePath()
            compassCtx.fillStyle = "#FFFFFF"
            compassCtx.fill()
            compassCtx.strokeStyle = "#000000"
            compassCtx.lineWidth = 1
            compassCtx.stroke()

            compassCtx.restore()
        }

        function drawQiblaArrow() {
            const centerX = 150
            const centerY = 150
            const angle = ((qiblaDirection - 90) * Math.PI) / 180

            compassCtx.save()
            compassCtx.translate(centerX, centerY)
            compassCtx.rotate(angle)

            // رسم سهم القبلة
            compassCtx.beginPath()
            compassCtx.moveTo(0, -100)
            compassCtx.lineTo(-15, -70)
            compassCtx.lineTo(15, -70)
            compassCtx.closePath()
            compassCtx.fillStyle = "#4CAF50"
            compassCtx.fill()
            compassCtx.strokeStyle = "#2E7D32"
            compassCtx.lineWidth = 2
            compassCtx.stroke()

            // إضافة رمز الكعبة
            compassCtx.fillStyle = "#FFFFFF"
            compassCtx.font = "bold 16px Arial"
            compassCtx.textAlign = "center"
            compassCtx.fillText("🕋", 0, -80)

            compassCtx.restore()
        }

        function calculateQiblaDirection(lat, lng) {
            // إحداثيات الكعبة المشرفة بدقة عالية
            const kaabaLat = 21.422487
            const kaabaLng = 39.826206

            // تحويل الدرجات إلى راديان
            const lat1 = (lat * Math.PI) / 180
            const lat2 = (kaabaLat * Math.PI) / 180
            const dLng = ((kaabaLng - lng) * Math.PI) / 180

            // حساب الاتجاه باستخدام معادلة الكرة الأرضية
            const y = Math.sin(dLng) * Math.cos(lat2)
            const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLng)

            let bearing = (Math.atan2(y, x) * 180) / Math.PI
            bearing = (bearing + 360) % 360

            return bearing
        }

        function updateCompassDisplay() {
            const deviceDirectionElement = document.getElementById("device-direction")
            const qiblaDirectionElement = document.getElementById("qibla-direction")

            if (deviceDirectionElement) {
                const directionName = getDirectionName(deviceHeading)
                deviceDirectionElement.textContent = `الاتجاه الحالي: ${directionName} ${Math.round(deviceHeading)}°`
            }

            if (qiblaDirectionElement && qiblaDirection !== 0) {
                const qiblaDirectionName = getDirectionName(qiblaDirection)
                qiblaDirectionElement.textContent = `القبلة: ${Math.round(qiblaDirection)}° - ${qiblaDirectionName}`

                // حساب الفرق بين اتجاه الجهاز واتجاه القبلة
                const difference = Math.abs(deviceHeading - qiblaDirection)
                const minDifference = Math.min(difference, 360 - difference)

                if (minDifference < 5) {
                    qiblaDirectionElement.style.color = "#4CAF50"
                    qiblaDirectionElement.textContent += " ✓ اتجاه صحيح"

                    if (userData.settings.vibrationEnabled && "vibrate" in navigator) {
                        navigator.vibrate(100)
                    }
                } else {
                    qiblaDirectionElement.style.color = "#FFC107"
                }
            }

            drawCompass()
        }

        function getDirectionName(angle) {
            const directions = [
                "الشمال",
                "الشمال الشرقي",
                "الشرق",
                "الجنوب الشرقي",
                "الجنوب",
                "الجنوب الغربي",
                "الغرب",
                "الشمال الغربي",
            ]
            const index = Math.round(angle / 45) % 8
            return directions[index]
        }

        function requestLocationPermission() {
            if (!navigator.geolocation) {
                alert("المتصفح لا يدعم تحديد الموقع")
                return
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    userLocation = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude,
                    }

                    qiblaDirection = calculateQiblaDirection(userLocation.latitude, userLocation.longitude)

                    initializeCompass() // ✅ هنا الإضافة الصحيحة

                    qiblaDirection = calculateQiblaDirection(userLocation.latitude, userLocation.longitude)

                    const coordinatesElement = document.getElementById("coordinates")
                    if (coordinatesElement) {
                        coordinatesElement.textContent = `الإحداثيات: ${userLocation.latitude.toFixed(6)}, ${userLocation.longitude.toFixed(6)}`
                    }

                    updateCompassDisplay()

                    // طلب إذن استخدام البوصلة على iOS
                    if (
                        typeof DeviceOrientationEvent !== "undefined" &&
                        typeof DeviceOrientationEvent.requestPermission === "function"
                    ) {
                        DeviceOrientationEvent.requestPermission().then((response) => {
                            if (response === "granted") {
                                startCompass()
                            }
                        })
                    } else {
                        startCompass()
                    }
                },
                (error) => {
                    alert("لا يمكن تحديد موقعك. تأكد من تفعيل خدمات الموقع.")
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000,
                },
            )
        }

        function startCompass() {
            if (window.DeviceOrientationEvent) {
                window.addEventListener("deviceorientation", (event) => {
                    // تحسين دقة البوصلة
                    let alpha = event.alpha
                    if (alpha !== null) {
                        // تطبيق تصحيح للانحراف المغناطيسي إذا كان متاحاً
                        if (event.webkitCompassHeading) {
                            alpha = event.webkitCompassHeading
                        }
                        deviceHeading = alpha
                        updateCompassDisplay()
                    }
                })
            } else {
                alert("جهازك لا يدعم البوصلة")
            }
        }

        //async function getPrayerTimes() {
        //  try {
        //    let latitude, longitude

        //    if (navigator.geolocation) {
        //      const position = await new Promise((resolve, reject) => {
        //        navigator.geolocation.getCurrentPosition(resolve, reject, {
        //          enableHighAccuracy: true,
        //          timeout: 10000,
        //          maximumAge: 60000,
        //        })
        //      })
        //      latitude = position.coords.latitude
        //      longitude = position.coords.longitude
        //    } else {
        //      // إحداثيات القاهرة كافتراضي
        //      latitude = 30.0444
        //      longitude = 31.2357
        //    }

        //    const today = new Date()
        //    const response = await fetch(
        //      `https://api.aladhan.com/v1/timings/${Math.floor(today.getTime() / 1000)}?latitude=${latitude}&longitude=${longitude}&method=5`,
        //    )
        //    const data = await response.json()

        //    if (data.code === 200) {
        //      userData.prayerTimes = data.data.timings
        //      userData.location = { latitude, longitude }
        //      updatePrayerTimesDisplay()
        //      checkMissedPrayers()
        //      saveUserData()
        //    }
        //  } catch (error) {
        //    console.error("Error getting prayer times:", error)
        //    setDefaultPrayerTimes()
        //  }
        //}

        //function setDefaultPrayerTimes() {
        //  userData.prayerTimes = {
        //    Fajr: "05:00",
        //    Dhuhr: "12:00",
        //    Asr: "15:30",
        //    Maghrib: "18:00",
        //    Isha: "19:30",
        //  }
        //  updatePrayerTimesDisplay()
        //}
        async function getPrayerTimes() {
            try {
                let latitude, longitude;
                let isLocationEnabled = true;

                if (navigator.geolocation) {
                    try {
                        const position = await new Promise((resolve, reject) => {
                            navigator.geolocation.getCurrentPosition(resolve, reject, {
                                enableHighAccuracy: true,
                                timeout: 10000,
                                maximumAge: 60000,
                            });
                        });
                        latitude = position.coords.latitude;
                        longitude = position.coords.longitude;
                    } catch (error) {
                        // إذا فشل جلب الموقع، استخدم إحداثيات القاهرة
                        latitude = 30.0444;
                        longitude = 31.2357;
                        isLocationEnabled = false;
                    }
                } else {
                    // إذا المتصفح مش بيدعم الموقع، استخدم إحداثيات القاهرة
                    latitude = 30.0444;
                    longitude = 31.2357;
                    isLocationEnabled = false;
                }

                const today = new Date();
                const response = await fetch(
                    `https://api.aladhan.com/v1/timings/${Math.floor(today.getTime() / 1000)}?latitude=${latitude}&longitude=${longitude}&method=5`
                );
                const data = await response.json();

                if (data.code === 200) {
                    userData.prayerTimes = data.data.timings;
                    userData.location = { latitude, longitude };
                    updatePrayerTimesDisplay();
                    checkMissedPrayers();
                    saveUserData();

                    // إظهار رسالة تحذير إذا الموقع مش مفعل
                    const locationAlert = document.getElementById('locationAlert');
                    if (!isLocationEnabled && locationAlert) {
                        locationAlert.style.display = 'block';
                        locationAlert.innerHTML = `
                                                                                            <span onclick="closeAlert()" style="cursor: pointer;">×</span>
                                                                                            يرجى تفعيل الموقع لعرض أوقات الصلاة بدقة.
                                                                                            <br>
                                                                                            <span>⚠️ الأوقات المعروضة للقاهرة.</span>
                                                                                            `;
                    } else if (locationAlert) {
                        locationAlert.style.display = 'none';
                    }
                } else {
                    throw new Error('Failed to fetch prayer times');
                }
            } catch (error) {
                console.error("Error getting prayer times:", error);
                // في حالة فشل الـ API، حاول مرة أخرى بإحداثيات القاهرة
                try {
                    const latitude = 30.0444;
                    const longitude = 31.2357;
                    const today = new Date();
                    const response = await fetch(
                        `https://api.aladhan.com/v1/timings/${Math.floor(today.getTime() / 1000)}?latitude=${latitude}&longitude=${longitude}&method=5`
                    );
                    const data = await response.json();

                    if (data.code === 200) {
                        userData.prayerTimes = data.data.timings;
                        userData.location = { latitude, longitude };
                        updatePrayerTimesDisplay();
                        updatePrayerTimesDisplay()
                        checkMissedPrayers();
                        saveUserData();

                        const locationAlert = document.getElementById('locationAlert');
                        if (locationAlert) {
                            locationAlert.style.display = 'block';
                            locationAlert.innerHTML = `
                                                                                            <span onclick="closeAlert()" style="cursor: pointer;">×</span>
                                                                                            يرجى تفعيل الموقع لعرض أوقات الصلاة بدقة.
                                                                                            <br>
                                                                                            <span>⚠️ الأوقات المعروضة للقاهرة.</span>
                                                                                            `;
                        }
                    }
                } catch (fallbackError) {
                    console.error("Error getting Cairo prayer times:", fallbackError);
                    // لو فشل كل شيء، اعرض رسالة خطأ
                    const locationAlert = document.getElementById('locationAlert');
                    if (locationAlert) {
                        locationAlert.style.display = 'block';
                        locationAlert.innerHTML = `
                                                                                            <span onclick="closeAlert()" style="cursor: pointer;">×</span>
                                                                                            فشل جلب أوقات الصلاة. تأكد من الاتصال بالإنترنت.
                                                                                            `;
                    }
                }
            }
        }
        function updatePrayerTimesDisplay() {
            if (!userData.prayerTimes) return

            const prayerMapping = {
                fajr: "Fajr",
                dhuhr: "Dhuhr",
                asr: "Asr",
                maghrib: "Maghrib",
                isha: "Isha",
            }

            Object.keys(prayerMapping).forEach((prayer) => {
                const timeElement = document.getElementById(`${prayer}-time`)
                if (timeElement && userData.prayerTimes[prayerMapping[prayer]]) {
                    const time = userData.prayerTimes[prayerMapping[prayer]]
                    timeElement.textContent = formatTime(time)
                }
            })
        }

        function formatTime(timeString) {
            const [hours, minutes] = timeString.split(":")
            const hour = Number.parseInt(hours)
            const ampm = hour >= 12 ? "م" : "ص"
            const displayHour = hour > 12 ? hour - 12 : hour === 0 ? 12 : hour
            return `${displayHour}:${minutes} ${ampm}`
        }

        function checkMissedPrayers() {
            if (!userData.prayerTimes) return

            const now = new Date()
            const currentTime = `${now.getHours().toString().padStart(2, "0")}:${now.getMinutes().toString().padStart(2, "0")}`

            const prayerMapping = {
                fajr: "Fajr",
                dhuhr: "Dhuhr",
                asr: "Asr",
                maghrib: "Maghrib",
                isha: "Isha",
            }
            //اذاننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننننن
            if (localStorage.getItem("azanEnabled") === "true") {
                scheduleAllAzans(userData.prayerTimes);
            }

            Object.keys(prayerMapping).forEach((prayer) => {
                const prayerTime = userData.prayerTimes[prayerMapping[prayer]]
                if (prayerTime && isTimePassed(prayerTime, currentTime) && !userData.prayers[prayer]) {
                    const card = document.getElementById(`${prayer}-card`)
                    if (card) {
                        card.classList.add("prayer-missed")

                        // تغيير لون النص إلى اللون الأحمر
                        const nameElement = card.querySelector(".prayer-name")
                        const timeElement = card.querySelector(".prayer-time")

                        if (nameElement) nameElement.style.color = "var(--danger-color)"
                        if (timeElement) timeElement.style.color = "var(--danger-color)"
                    }
                }
            })
        }

        function isTimePassed(prayerTime, currentTime) {
            const [pHours, pMinutes] = prayerTime.split(":").map(Number)
            const [cHours, cMinutes] = currentTime.split(":").map(Number)

            const prayerMinutes = pHours * 60 + pMinutes
            const currentMinutes = cHours * 60 + cMinutes

            return currentMinutes > prayerMinutes
        }

        function createDhikrSound() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)()
            }

            const oscillator = audioContext.createOscillator()
            const gainNode = audioContext.createGain()

            oscillator.connect(gainNode)
            gainNode.connect(audioContext.destination)

            oscillator.frequency.setValueAtTime(800, audioContext.currentTime)
            oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1)

            gainNode.gain.setValueAtTime(0.03, audioContext.currentTime)
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1)

            oscillator.start(audioContext.currentTime)
            oscillator.stop(audioContext.currentTime + 0.1)
        }

        function playFeedbackFast() {
            if (userData.settings.soundEnabled) {
                createDhikrSound()
            }

            if (userData.settings.vibrationEnabled && "vibrate" in navigator) {
                navigator.vibrate(25)
            }
        }

        function showCelebration(message, type = "success") {
            const celebration = document.createElement("div")
            celebration.className = "celebration"
            celebration.innerHTML = `
                                                                                            <div style="font-size: 48px; margin-bottom: 10px;">🎉</div>
                                                                                            <div>${message}</div>
                                                                                            `

            document.body.appendChild(celebration)

            createConfetti()

            setTimeout(() => {
                celebration.remove()
            }, 3000)

            if (userData.settings.soundEnabled) {
                playCelebrationSound()
            }

            if (userData.settings.vibrationEnabled && "vibrate" in navigator) {
                navigator.vibrate([300, 100, 300, 100, 300])
            }
        }

        function createConfetti() {
            const colors = ["#FFD700", "#FF6B6B", "#4ECDC4", "#45B7D1", "#96CEB4", "#FFEAA7"]

            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement("div")
                    confetti.className = "confetti"
                    confetti.style.left = Math.random() * 100 + "vw"
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)]
                    confetti.style.animationDelay = Math.random() * 3 + "s"

                    document.body.appendChild(confetti)

                    setTimeout(() => {
                        confetti.remove()
                    }, 3000)
                }, i * 50)
            }
        }

        function playCelebrationSound() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)()
            }

            const notes = [523.25, 659.25, 783.99, 1046.5]

            notes.forEach((freq, index) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator()
                    const gainNode = audioContext.createGain()

                    oscillator.connect(gainNode)
                    gainNode.connect(audioContext.destination)

                    oscillator.frequency.setValueAtTime(freq, audioContext.currentTime)
                    gainNode.gain.setValueAtTime(0.15, audioContext.currentTime)
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3)

                    oscillator.start(audioContext.currentTime)
                    oscillator.stop(audioContext.currentTime + 0.3)
                }, index * 150)
            })
        }

        function showProblemSolution(problemType) {
            const solution = problemSolutions[problemType]
            const aiResponse = document.getElementById("ai-response")

            if (solution && aiResponse) {
                aiResponse.innerHTML = `
                                                                                            <div class="ai-response">
                                                                                                <h4>${solution.title}</h4>
                                                                                                ${solution.content}
                                                                                            </div>
                                                                                            `
                aiResponse.style.display = "block"
                aiResponse.scrollIntoView({ behavior: "smooth" })
            }
        }

        function releaseNegativeEnergy() {
            const text = document.getElementById("release-text").value.trim()
            const aiResponse = document.getElementById("ai-response")

            if (!text) {
                alert("من فضلك اكتب ما يزعجك أولاً")
                return
            }

            aiResponse.innerHTML = `
                                                                                            <div class="ai-response">
                                                                                                <h4>🤲 نصيحة إسلامية مخصصة</h4>
                                                                                                <p><strong>قال تعالى:</strong> "وَمَن يَتَّقِ اللَّهَ يَجْعَل لَّهُ مَخْرَجًا"</p>
                                                                                                <ul>
                                                                                                    <li>📿 ادع بهذا الدعاء: "اللهم إني أعوذ بك من الهم والحزن والعجز والكسل"</li>
                                                                                                    <li>💧 توضأ وصل ركعتين - الصلاة تهدئ النفس</li>
                                                                                                    <li>📖 اقرأ سورة الشرح - تفرج الهموم</li>
                                                                                                    <li>🌱 تذكر أن مع العسر يسراً</li>
                                                                                                    <li>💝 استغفر كثيراً - الاستغفار يزيل الهم</li>
                                                                                                </ul>
                                                                                                <p style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                                                                                                    <strong>💡 تذكر:</strong> كل ما تمر به هو ابتلاء من الله ليرفع درجتك. اصبر واحتسب الأجر، والله معك.
                                                                                                </p>
                                                                                            </div>
                                                                                            `
            aiResponse.style.display = "block"
            aiResponse.scrollIntoView({ behavior: "smooth" })

            document.getElementById("release-text").value = ""
        }

        function loadUserData() {
            const saved = localStorage.getItem("religiousAppData")
            if (saved) {
                const savedData = JSON.parse(saved)
                userData = { ...userData, ...savedData }

                if (userData.lastReset !== today) {
                    resetDailyData()
                }
            }

            // تهيئة dhikrTotals إذا لم تكن موجودة
            if (!userData.dhikrTotals) {
                userData.dhikrTotals = {
                    subhanallah: 0,
                    alhamdulillah: 0,
                    lailaha: 0,
                    allahuakbar: 0,
                    subhanallahwabihamdihi: 0,
                    astaghfirullah: 0,
                }
            }

            // تهيئة خطط القرآن إذا لم تكن موجودة
            if (!userData.quranPlans) {
                userData.quranPlans = {
                    month: { completed: 0, total: 30, dailyCompleted: false },
                    "half-month": { completed: 0, total: 15, dailyCompleted: false },
                    "ten-days": { completed: 0, total: 10, dailyCompleted: false },
                    week: { completed: 0, total: 7, dailyCompleted: false },
                    "two-months": { completed: 0, total: 60, dailyCompleted: false },
                    custom: { completed: 0, total: 0, dailyCompleted: false, type: "", value: 0 },
                }
            }

            initializeDhikr()
            initializeNewAdhkar()
            initializeQuranPlans()
            updatePrayerStatus()
            updateStats()
            updateChallenge()
            updateDarkMode()
            updateSettings()
            updateDailyQuote()
        }

        function saveUserData() {
            localStorage.setItem("religiousAppData", JSON.stringify(userData))
        }

        function resetDailyData() {
            userData.lastReset = today
            userData.prayers = {
                fajr: false,
                dhuhr: false,
                asr: false,
                maghrib: false,
                isha: false,
            }

            Object.keys(userData.dhikr).forEach((key) => {
                userData.dhikr[key] = 0
            })

            Object.keys(userData.customDhikr).forEach((key) => {
                userData.customDhikr[key].count = 0
            })

            adhkarCategories.forEach((category) => {
                if (userData.newAdhkar[category.id]) {
                    category.content.forEach((item, index) => {
                        if (userData.newAdhkar[category.id].items[index]) {
                            userData.newAdhkar[category.id].items[index].count = 0
                        }
                    })
                }
            })

            // إعادة تعيين حالة القراءة اليومية لخطط القرآن
            Object.keys(userData.quranPlans).forEach((planId) => {
                userData.quranPlans[planId].dailyCompleted = false
            })

            userData.challenge.completed = false

            const dayOfWeek = new Date().getDay()
            userData.weeklyProgress[dayOfWeek] = 0

            saveUserData()
        }

        function initializeDhikr() {
            const container = document.getElementById("dhikr-container")
            if (!container) return

            let html = ""

            defaultDhikrItems.forEach((item) => {
                const count = userData.dhikr[item.id] || 0
                const totalCount = userData.dhikrTotals[item.id] || 0

                html += `
                                                                                            <div class="card dhikr-card">
                                                                                                <div class="dhikr-total-count">الإجمالي: ${totalCount}</div>
                                                                                                <div class="dhikr-text">${item.text}</div>
                                                                                                <div class="dhikr-count" id="${item.id}-count">${count}</div>
                                                                                                <div class="dhikr-buttons">
                                                                                                    <button class="btn btn-circle" onclick="incrementDhikr('${item.id}')">+</button>
                                                                                                    <button class="btn btn-circle btn-warning" onclick="resetDhikr('${item.id}')">↻</button>
                                                                                                </div>
                                                                                            </div>
                                                                                            `
            })

            Object.keys(userData.customDhikr).forEach((key) => {
                const dhikr = userData.customDhikr[key]
                html += `
                                                                                            <div class="card dhikr-card">
                                                                                                <div class="dhikr-total-count">الإجمالي: ${dhikr.totalCount || 0}</div>
                                                                                                <div class="dhikr-text">${dhikr.text}</div>
                                                                                                <div class="dhikr-count" id="${key}-count">${dhikr.count}</div>
                                                                                                <div class="dhikr-buttons">
                                                                                                    <button class="btn btn-circle" onclick="incrementDhikr('${key}')">+</button>
                                                                                                    <button class="btn btn-circle btn-warning" onclick="resetDhikr('${key}')">↻</button>
                                                                                                </div>
                                                                                                <div class="dhikr-actions">
                                                                                                    <button class="dhikr-delete" onclick="deleteCustomDhikr('${key}')" title="حذف">🗑️</button>
                                                                                                </div>
                                                                                            </div>
                                                                                            `
            })

            container.innerHTML = html
        }

        function incrementDhikr(dhikrId) {
            if (defaultDhikrItems.find((item) => item.id === dhikrId)) {
                userData.dhikr[dhikrId]++
                userData.dhikrTotals[dhikrId]++
                userData.totalStats.dhikr++
            } else if (userData.customDhikr[dhikrId]) {
                userData.customDhikr[dhikrId].count++
                if (!userData.customDhikr[dhikrId].totalCount) {
                    userData.customDhikr[dhikrId].totalCount = 0
                }
                userData.customDhikr[dhikrId].totalCount++
                userData.totalStats.dhikr++
            }

            const countElement = document.getElementById(`${dhikrId}-count`)
            if (countElement) {
                countElement.textContent = defaultDhikrItems.find((item) => item.id === dhikrId)
                    ? userData.dhikr[dhikrId]
                    : userData.customDhikr[dhikrId].count

                countElement.classList.add("pulse")
                setTimeout(() => countElement.classList.remove("pulse"), 300)
            }

            playFeedbackFast()

            const totalCount = getTotalDhikrCount()
            if (totalCount > 0 && totalCount % 100 === 0) {
                showCelebration(`🎉 مبروك! وصلت إلى ${totalCount} تسبيحة<br>استمر في ذكر الله`)
            }

            updateStats()
            initializeDhikr() // إعادة تحديث العرض لإظهار الإجمالي المحدث
            saveUserData()
        }

        function resetDhikr(dhikrId) {
            if (confirm("هل أنت متأكد من إعادة تعيين العداد الحالي؟ (الإجمالي لن يتأثر)")) {
                if (defaultDhikrItems.find((item) => item.id === dhikrId)) {
                    userData.dhikr[dhikrId] = 0
                } else if (userData.customDhikr[dhikrId]) {
                    userData.customDhikr[dhikrId].count = 0
                }

                const countElement = document.getElementById(`${dhikrId}-count`)
                if (countElement) {
                    countElement.textContent = "0"
                }

                updateStats()
                saveUserData()
            }
        }

        function getTotalDhikrCount() {
            let total = Object.values(userData.dhikr).reduce((sum, count) => sum + count, 0)
            total += Object.values(userData.customDhikr).reduce((sum, dhikr) => sum + dhikr.count, 0)
            return total
        }

        function addCustomDhikr() {
            const text = document.getElementById("new-dhikr-text").value.trim()
            if (!text) {
                alert("من فضلك أدخل نص التسبيح")
                return
            }

            const id = "custom_" + Date.now()
            userData.customDhikr[id] = {
                text: text,
                count: 0,
                totalCount: 0,
            }

            document.getElementById("new-dhikr-text").value = ""
            initializeDhikr()
            saveUserData()
        }

        function deleteCustomDhikr(dhikrId) {
            if (confirm("هل أنت متأكد من حذف هذا التسبيح؟")) {
                delete userData.customDhikr[dhikrId]
                initializeDhikr()
                saveUserData()
            }
        }

        function togglePrayer(prayer) {
            userData.prayers[prayer] = !userData.prayers[prayer]

            if (userData.prayers[prayer]) {
                userData.totalStats.prayers++
                playFeedbackFast()

                const prayerName = document.querySelector("#" + prayer + "-card .prayer-name").textContent.trim();
                showSmallMessage(prayerName);



                const completedPrayers = Object.values(userData.prayers).filter((p) => p).length
                if (completedPrayers === 5) {
                    showCelebration("🕋 مبروك! أكملت جميع الصلوات اليوم<br>جعلها الله في ميزان حسناتك")
                }
            }

            updatePrayerStatus()
            updateStats()
            saveUserData()
        }

        function updatePrayerStatus() {
            const prayers = ["fajr", "dhuhr", "asr", "maghrib", "isha"]
            let completedCount = 0

            prayers.forEach((prayer) => {
                const btn = document.getElementById(`${prayer}-btn`)
                const card = document.getElementById(`${prayer}-card`)

                if (userData.prayers[prayer]) {
                    btn.textContent = "تمت الصلاه✓"
                    btn.className = "btn btn-success"
                    card.classList.add("prayer-done")
                    card.classList.remove("prayer-missed")
                    completedCount++
                } else {
                    btn.textContent = "صليت"
                    btn.className = "btn"
                    card.classList.remove("prayer-done")
                }
            })

            const progressBar = document.getElementById("prayer-progress")
            const prayerCount = document.getElementById("prayer-count")

            if (progressBar) {
                progressBar.style.width = `${(completedCount / 5) * 100}%`
            }

            if (prayerCount) {
                prayerCount.textContent = completedCount
            }
        }

        function updateChallenge() {
            const challengeTitle = document.getElementById("challenge-title")
            const challengeDescription = document.getElementById("challenge-description")
            const challengeBtn = document.getElementById("challenge-btn")
            const challengeProgress = document.getElementById("challenge-progress")

            if (!challengeTitle || !challengeDescription || !challengeBtn || !challengeProgress) return

            const challengeIndex = getDailyChallengeIndex()
            const challenge = dailyChallenges[challengeIndex]

            challengeTitle.textContent = challenge.title
            challengeDescription.textContent = challenge.description

            if (userData.challenge.completed) {
                challengeBtn.textContent = "✓ تم إنجاز التحدي"
                challengeBtn.className = "btn btn-large btn-success"
                challengeProgress.style.width = "100%"
            } else {
                challengeBtn.textContent = "أنجزت التحدي"
                challengeBtn.className = "btn btn-large"
                challengeProgress.style.width = "0%"
            }

            updatePreviousChallenges()
        }

        function getDailyChallengeIndex() {
            const today = new Date()
            const seed = today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate()
            return seed % dailyChallenges.length
        }

        function toggleChallenge() {
            userData.challenge.completed = !userData.challenge.completed

            if (userData.challenge.completed) {
                userData.totalStats.challenges++
                playFeedbackFast()
                showCelebration("🎯 مبروك! أنجزت تحدي اليوم<br>استمر في العمل الصالح")

                const challengeIndex = getDailyChallengeIndex()
                const challenge = dailyChallenges[challengeIndex]
                userData.challenge.history.unshift({
                    date: today,
                    challenge: challenge.title,
                    completed: true,
                })

                if (userData.challenge.history.length > 10) {
                    userData.challenge.history = userData.challenge.history.slice(0, 10)
                }
            }

            updateChallenge()
            updateStats()
            saveUserData()
        }

        function updatePreviousChallenges() {
            const container = document.getElementById("previous-challenges")
            if (!container) return

            if (userData.challenge.history.length === 0) {
                container.innerHTML = "<li>لا توجد تحديات سابقة</li>"
                return
            }

            let html = ""
            userData.challenge.history.forEach((item) => {
                const status = item.completed ? "✓" : "✗"
                const statusClass = item.completed ? "success" : "danger"
                html += `<li><span class="btn-${statusClass}">${status}</span> ${item.challenge} - ${item.date}</li>`
            })

            container.innerHTML = html
        }

        function updateStats() {
            let adhkarToday = 0;
            let adhkarTotal = 0;
            const completedPrayers = Object.values(userData.prayers).filter((p) => p).length
            const totalDhikr = getTotalDhikrCount()
            const completedAdhkar = Object.values(userData.newAdhkar).reduce((sum, category) => sum + category.totalCount, 0)
            const challengeStatus = userData.challenge.completed ? "نعم" : "لا"

            // حساب إحصائيات القرآن اليومية
            const dailyQuranReading = Object.values(userData.quranPlans).filter((plan) => plan.dailyCompleted).length

            const statsPrayers = document.getElementById("stats-prayers")
            const statsDhikr = document.getElementById("stats-dhikr")
            const statsAdhkar = document.getElementById("stats-adhkar")
            const statsQuran = document.getElementById("stats-quran")
            const statsChallenge = document.getElementById("stats-challenge")

            if (statsPrayers) statsPrayers.textContent = `${completedPrayers}/5`
            if (statsDhikr) statsDhikr.textContent = totalDhikr
            if (statsAdhkar) statsAdhkar.textContent = completedAdhkar
            if (statsQuran) statsQuran.textContent = dailyQuranReading
            if (statsChallenge) statsChallenge.textContent = challengeStatus

            updateDailyRating(completedPrayers, totalDhikr, completedAdhkar, userData.challenge.completed, dailyQuranReading)
            updateWeeklyProgress()
            updateTotalStats()
        }

        function updateDailyRating(prayers, dhikr, adhkar, challenge, quranReading) {
            const ratingElement = document.getElementById("daily-rating")
            if (!ratingElement) return

            let score = 0
            score += prayers * 15
            score += Math.min(dhikr / 10, 10) * 2
            //score += adhkar * 5
            score += challenge ? 20 : 0
            score += quranReading * 10 // إضافة نقاط لقراءة القرآن

            let rating, className
            if (score >= 90) {
                rating = "ممتاز! يوم مبارك";
                className = "rating-excellent";
            } else if (score >= 65) {
                rating = "جيد جدًا، استمر";
                className = "rating-very-good";
            } else if (score >= 50) {
                rating = "جيد، يمكنك تحسين أكثر";
                className = "rating-good";
            } else {
                rating = "محتاج تقرب أكتر من الله";
                className = "rating-needs-improvement";
            }

            ratingElement.textContent = `تقييم اليوم: ${rating}`
            ratingElement.className = `rating ${className}`

            const dayOfWeek = new Date().getDay()
            userData.weeklyProgress[dayOfWeek] = score
        }

        function updateWeeklyProgress() {
            const weeklyProgress = document.getElementById("weekly-progress")
            const weeklyPercentage = document.getElementById("weekly-percentage")

            if (!weeklyProgress || !weeklyPercentage) return

            const totalScore = userData.weeklyProgress.reduce((sum, score) => sum + score, 0)
            const averageScore = totalScore / 7
            const percentage = Math.round(averageScore)

            weeklyProgress.style.width = `${percentage}%`
            weeklyPercentage.textContent = `${percentage}%`
        }

        function updateTotalStats() {
            const totalPrayers = document.getElementById("total-prayers")
            const totalDhikr = document.getElementById("total-dhikr")
            const totalAdhkar = document.getElementById("total-adhkar")
            const totalQuranKhatm = document.getElementById("total-quran-khatm")
            const totalChallenges = document.getElementById("total-challenges")

            if (totalPrayers) totalPrayers.textContent = userData.totalStats.prayers || 0
            if (totalDhikr) totalDhikr.textContent = userData.totalStats.dhikr || 0
            if (totalAdhkar) totalAdhkar.textContent = userData.totalStats.adhkar || 0
            if (totalQuranKhatm) totalQuranKhatm.textContent = userData.totalStats.quranKhatm || 0
            if (totalChallenges) totalChallenges.textContent = userData.totalStats.challenges || 0
        }

        function updateDailyQuote() {
            const quoteElement = document.getElementById("daily-quote")
            if (!quoteElement) return

            const today = new Date()
            const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24)
            const quoteIndex = dayOfYear % dailyQuotes.length

            quoteElement.textContent = `"${dailyQuotes[quoteIndex]}"`
        }

        function showSection(sectionId) {
            document.querySelectorAll("section").forEach((section) => {
                section.classList.remove("active")
            })

            document.querySelectorAll(".nav-item").forEach((item) => {
                item.classList.remove("active")
            })

            const targetSection = document.getElementById(sectionId)
            const targetNavItem = document.getElementById(`nav-${sectionId}`)

            if (targetSection) {
                targetSection.classList.add("active")
            }

            if (targetNavItem) {
                targetNavItem.classList.add("active")
            }

            if (sectionId === "qibla") {
                setTimeout(() => {
                    initializeCompass()
                }, 100)
            }
        }

        function toggleDarkMode() {
            userData.settings.darkMode = !userData.settings.darkMode
            updateDarkMode()
            saveUserData()
        }

        function updateDarkMode() {
            const toggle = document.getElementById("darkModeToggle")
            if (userData.settings.darkMode) {
                document.body.classList.add("dark-mode")
                toggle.classList.add("active")
            } else {
                document.body.classList.remove("dark-mode")
                toggle.classList.remove("active")
            }
        }

        function toggleSoundFast() {
            userData.settings.soundEnabled = !userData.settings.soundEnabled
            updateSettings()
            saveUserData()
        }

        function toggleVibrationFast() {
            userData.settings.vibrationEnabled = !userData.settings.vibrationEnabled
            updateSettings()
            saveUserData()
        }

        function togglePrayerNotificationsFast() {
            userData.settings.prayerNotifications = !userData.settings.prayerNotifications
            updateSettings()
            saveUserData()
        }

        function updateSettings() {
            const soundToggle = document.getElementById("sound-toggle")
            const vibrationToggle = document.getElementById("vibration-toggle")
            const prayerNotificationsToggle = document.getElementById("prayer-notifications-toggle")

            if (soundToggle) {
                soundToggle.classList.toggle("active", userData.settings.soundEnabled)
            }

            if (vibrationToggle) {
                vibrationToggle.classList.toggle("active", userData.settings.vibrationEnabled)
            }

            if (prayerNotificationsToggle) {
                prayerNotificationsToggle.classList.toggle("active", userData.settings.prayerNotifications)
            }
        }

        function checkForUpdates() {
            if ("serviceWorker" in navigator && navigator.serviceWorker.controller) {
                navigator.serviceWorker.controller.postMessage({ type: "CHECK_UPDATE" })

                // محاكاة فحص التحديث
                setTimeout(() => {
                    const isUpToDate = Math.random() > 0.5 // محاكاة عشوائية

                    if (isUpToDate) {
                        alert("التطبيق محدث إلى أحدث إصدار")
                    } else {
                        if (confirm("يوجد تحديث جديد. هل تريد تحديث التطبيق الآن؟")) {
                            window.location.reload()
                        }
                    }
                }, 1000)
            } else {
                alert("التطبيق محدث إلى أحدث إصدار")
            }
        }

        function resetAllData() {
            if (confirm("هل أنت متأكد من مسح جميع البيانات؟ هذا الإجراء لا يمكن التراجع عنه.")) {
                localStorage.removeItem("religiousAppData")
                location.reload()
                //ججججججججججديدددددددددددددددددددددددددددددددددددددددددددددددددددددددددددددددددددددددددددددددددددددد
                localStorage.clear();

            }
        }

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt()
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === "accepted") {
                        console.log("User accepted the install prompt")
                    }
                    deferredPrompt = null
                })
            } else {
                alert("التطبيق مثبت بالفعل أو المتصفح لا يدعم التثبيت")
            }
        }

        function hideInstallPrompt() {
            const prompt = document.getElementById("install-prompt")
            if (prompt) {
                prompt.style.display = "none"
            }
        }

        // معالجة زر الرجوع
        function handleBackButton() {
            const currentSection = document.querySelector("section.active")
            const currentSectionId = currentSection ? currentSection.id : "home"

            if (currentSectionId === "home") {
                // إذا كان في الصفحة الرئيسية، زيادة عداد الضغط
                backButtonPressCount++

                if (backButtonPressCount === 1) {
                    // أول ضغطة - إظهار رسالة
                    alert("اضغط مرة أخرى للخروج من التطبيق")

                    // إعادة تعيين العداد بعد ثانيتين
                    backButtonTimer = setTimeout(() => {
                        backButtonPressCount = 0
                    }, 2000)
                } else if (backButtonPressCount === 2) {
                    // ثاني ضغطة - الخروج من التطبيق
                    if (backButtonTimer) {
                        clearTimeout(backButtonTimer)
                    }
                    window.close()
                }
            } else {
                // إذا لم يكن في الصفحة الرئيسية، العودة للصفحة الرئيسية
                showSection("home")
                backButtonPressCount = 0
                if (backButtonTimer) {
                    clearTimeout(backButtonTimer)
                }
            }
        }

        // إضافة مستمعي الأحداث للتثبيت
        window.addEventListener("beforeinstallprompt", (e) => {
            e.preventDefault()
            deferredPrompt = e

            const installPrompt = document.getElementById("install-prompt")
            const installBtn = document.getElementById("install-btn")
            const settingsInstallBtn = document.getElementById("settings-install-btn")

            if (installPrompt) {
                installPrompt.classList.add("show")
            }

            if (installBtn) {
                installBtn.addEventListener("click", installApp)
            }

            if (settingsInstallBtn) {
                settingsInstallBtn.addEventListener("click", installApp)
            }
        })

        window.addEventListener("appinstalled", () => {
            console.log("PWA was installed")
            hideInstallPrompt()
        })



        // تهيئة التطبيق
        document.addEventListener("DOMContentLoaded", () => {
            loadUserData()
            getPrayerTimes()

            // طلب إذن الإشعارات
            requestNotificationPermission()

            // تحديث أوقات الصلاة كل ساعة
            setInterval(getPrayerTimes, 3600000)

            // فحص الصلوات الفائتة كل 5 دقائق
            setInterval(checkMissedPrayers, 300000)

            // فحص أوقات الصلاة كل دقيقة
            setInterval(checkCurrentPrayerTime, 60000)

            // إعادة تعيين العدادات اليومية عند منتصف الليل
            setInterval(() => {
                const now = new Date()
                if (now.getHours() === 0 && now.getMinutes() === 0) {
                    resetDailyData()
                }
            }, 60000)
        })
        // تحقق هل التنبيه مخفي مسبقًا
        window.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('locationAlertClosed') === 'true') {
                document.getElementById('locationAlert').style.display = 'none';
            }
        });

        // دالة الإغلاق والتخزين
        function closeAlert() {
            document.getElementById('locationAlert').style.display = 'none';
            localStorage.setItem('locationAlertClosed', 'true');
        }
        // تحميل حالة الأذان عند فتح الصفحة
        window.addEventListener("DOMContentLoaded", () => {
            const azanSetting = localStorage.getItem("azanEnabled");
            const isAzanEnabled = azanSetting === "true"; // هيكون false لو null
            const toggle = document.getElementById("azan-toggle");

            if (toggle) {
                toggle.classList.toggle("active", isAzanEnabled);
            }
        });


        // تغيير الحالة عند الضغط
        function toggleAzanSetting() {
            const toggle = document.getElementById("azan-toggle");
            const isActive = toggle.classList.toggle("active");
            localStorage.setItem("azanEnabled", isActive);
        }
        // 🟢 عند بداية التحميل، نثبت الحالة على الصفحة الرئيسية
        window.addEventListener("load", () => {
            history.replaceState({ section: "home" }, "", "");
        });

        // 🟡 تعريف الدالة الأساسية للتنقل بين الأقسام
        function showSection(sectionId, push = true) {
            document.querySelectorAll("section").forEach(section => {
                section.classList.remove("active");
            });
            document.getElementById(sectionId).classList.add("active");

            if (push) {
                history.pushState({ section: sectionId }, "", `#${sectionId}`);
            }
        }

        // 🟠 تحكم في زر الرجوع
        let lastBackPressTime = 0;

        window.addEventListener("popstate", (event) => {
            const sectionId = event.state && event.state.section;

            if (sectionId) {
                showSection(sectionId, false);
            } else {
                const now = Date.now();
                if (now - lastBackPressTime < 2000) {
                    // خروج فعلي ← في الموبايل هيقفل التطبيق
                    window.history.go(-2);
                } else {
                    showExitToast(); // عرض رسالة "اضغط مرة أخرى"
                    lastBackPressTime = now;

                    // إعادة الحالة للصفحة الرئيسية لمنع الخروج التلقائي
                    history.pushState({ section: "home" }, "", "#home");
                }
            }
        });

        // 🧱 رسالة الخروج (شكل أفضل من alert)
        function showExitToast() {
            const toast = document.createElement("div");
            toast.textContent = "اضغط مرة أخرى للخروج";
            toast.style.cssText = `
                                                                                            position: fixed;
                                                                                            bottom: 30px;
                                                                                            left: 50%;
                                                                                            transform: translateX(-50%);
                                                                                            background: rgba(0,0,0,0.8);
                                                                                            color: white;
                                                                                            padding: 10px 20px;
                                                                                            border-radius: 25px;
                                                                                            font-size: 16px;
                                                                                            z-index: 1000;
                                                                                            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        function displayTodayDate() {
            const dateContainer = document.getElementById("today-date");
            if (!dateContainer) return;

            // التاريخ الميلادي
            const today = new Date();
            const weekdays = ["الأحد", "الاثنين", "الثلاثاء", "الأربعاء", "الخميس", "الجمعة", "السبت"];
            const months = ["يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو", "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"];
            const dayName = weekdays[today.getDay()];
            const dateStr = `${dayName}، ${today.getDate()} ${months[today.getMonth()]} ${today.getFullYear()}`;

            // التاريخ الهجري
            const hijriFormatter = new Intl.DateTimeFormat('ar-SA-u-ca-islamic', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            const hijriDate = hijriFormatter.format(today);

            dateContainer.innerHTML = `📅 ${dateStr}<br>🕌 ${hijriDate} `;
        }

        window.addEventListener("DOMContentLoaded", displayTodayDate);
        //الاسممممممممممممممممممممممممممممممممممممممممممممممممممممممممممممممممممممممممممممممممممممم
        //function saveUserName() {
        //    const input = document.getElementById("userNameInput").value.trim();

        //    if (input.length >= 2 && input.toLowerCase() !== "مجهول") {
        //        localStorage.setItem("userName", input);
        //        document.getElementById("namePrompt").style.display = "none";
        //        showWelcomeMessage(input);
        //    } else {
        //        alert("من فضلك اكتب اسمًا حقيقيًا ❤️");
        //    }
        //}

        //function showWelcomeMessage(name) {
        //    const msg = document.getElementById("welcomeMessage");
        //    const sound = document.getElementById("welcomeSound");

        //    if (msg && sound) {
        //        msg.textContent = `🎉 أهلاً يا ${name}! وجودك معنا هو النور الحقيقي! 💚`;
        //        msg.style.display = "block";
        //        sound.play();

        //        // confetti
        //        confetti({
        //            particleCount: 100,
        //            spread: 80,
        //            origin: { y: 0.6 }
        //        });

        //        setTimeout(() => {
        //            msg.classList.add("show");
        //        }, 10);

        //        setTimeout(() => {
        //            msg.classList.remove("show");
        //            setTimeout(() => {
        //                msg.style.display = "none";
        //            }, 500);
        //        }, 3500);
        //    }
        //}


    </script>
    <!--<script>
        function incrementPrayerCount(prayer) {
            const today = new Date().toISOString().split('T')[0];
            const countKey = `prayerCount_${today}`;
            const prayerKey = `prayer_${prayer}_${today}`;

            let count = parseInt(localStorage.getItem(countKey)) || 0;

            let currentStatus = localStorage.getItem(prayerKey);
            currentStatus = currentStatus && currentStatus.toLowerCase() === 'true';

            if (currentStatus) {
                count = Math.max(count - 1, 0);
                localStorage.setItem(prayerKey, 'false');
            } else {
                count = Math.min(count + 1, 5);
                localStorage.setItem(prayerKey, 'true');
            }

            localStorage.setItem(countKey, count.toString());
            updatePrayerChart();
        }

        function updatePrayerChart() {
            const installDate = localStorage.getItem('installDate') || new Date().toISOString().split('T')[0];
            if (!localStorage.getItem('installDate')) {
                localStorage.setItem('installDate', installDate);
            }

            const today = new Date();
            const startDate = new Date(installDate);
            const labels = [];
            const prayerData = [];

            for (let i = 0; i < 10; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                const dateString = date.toISOString().split('T')[0];
                labels.push(dateString);
                const count = parseInt(localStorage.getItem(`prayerCount_${dateString}`)) || 0;
                prayerData.push(count);
            }

            const daysSinceInstall = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            if (daysSinceInstall >= 10) {
                const newStartDate = new Date(startDate);
                newStartDate.setDate(startDate.getDate() + 10);
                localStorage.setItem('installDate', newStartDate.toISOString().split('T')[0]);

                for (let i = 0; i < 10; i++) {
                    const oldDate = new Date(startDate);
                    oldDate.setDate(startDate.getDate() + i);
                    const oldKey = oldDate.toISOString().split('T')[0];
                    localStorage.removeItem(`prayerCount_${oldKey}`);
                    ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'].forEach(prayer => {
                        localStorage.removeItem(`prayer_${prayer}_${oldKey}`);
                    });
                }
            }

            // ✅ هنا نضيف حساب عدد الصلوات
            let last10Total = prayerData.reduce((a, b) => a + b, 0);
            document.getElementById("last10Total").innerText = last10Total;

            let overallTotal = 0;
            for (let key in localStorage) {
                if (key.startsWith("prayerCount_")) {
                    overallTotal += parseInt(localStorage.getItem(key)) || 0;
                }
            }
            document.getElementById("overallTotal").innerText = overallTotal;

            const ctx = document.getElementById('prayerChart').getContext('2d');
            if (window.prayerChartInstance) {
                window.prayerChartInstance.destroy();
            }

            window.prayerChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'عدد الصلوات',
                        data: prayerData,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1,
                                precision: 0,
                                callback: function (value) {
                                    return value;
                                }
                            },
                            title: { display: true, text: 'عدد الصلوات' }
                        },
                        x: {
                            title: { display: true, text: 'التاريخ' }
                        }
                    }
                }
            });
        }


        function showFullChart() {
            const ctx = document.getElementById('fullPrayerChart').getContext('2d');
            document.getElementById('fullChartContainer').style.display = 'block';

            const installDate = localStorage.getItem('installDate');
            if (!installDate) return;

            const startDate = new Date(installDate);
            const today = new Date();
            const labels = [];
            const data = [];

            const daysCount = Math.floor((today - startDate) / (1000 * 60 * 60 * 24)) + 1;

            for (let i = 0; i < daysCount; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                const dateString = date.toISOString().split('T')[0];
                labels.push(dateString);
                const count = parseInt(localStorage.getItem(`prayerCount_${dateString}`)) || 0;
                data.push(count);
            }

            if (window.fullPrayerChartInstance) {
                window.fullPrayerChartInstance.destroy();
            }

            window.fullPrayerChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'عدد الصلوات (كامل)',
                        data: data,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1,
                                precision: 0
                            },
                            title: { display: true, text: 'عدد الصلوات' }
                        },
                        x: {
                            title: { display: true, text: 'التاريخ الكامل' }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            updatePrayerChart();

            ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'].forEach(prayer => {
                const btn = document.getElementById(`${prayer}-btn`);
                if (btn) {
                    const originalOnClick = btn.onclick;
                    btn.onclick = function () {
                        if (originalOnClick) originalOnClick.apply(this, arguments);
                        incrementPrayerCount(prayer);
                    };
                }
            });
        });
    </script>-->
    <script>
        function incrementPrayerCount(prayer) {
            const today = new Date().toISOString().split('T')[0];
            const countKey = `prayerCount_${today}`;
            const prayerKey = `prayer_${prayer}_${today}`;
            let count = parseInt(localStorage.getItem(countKey)) || 0;
            let currentStatus = localStorage.getItem(prayerKey);
            currentStatus = currentStatus && currentStatus.toLowerCase() === 'true';

            if (currentStatus) {
                count = Math.max(count - 1, 0);
                localStorage.setItem(prayerKey, 'false');
            } else {
                count = Math.min(count + 1, 5);
                localStorage.setItem(prayerKey, 'true');
            }

            localStorage.setItem(countKey, count.toString());
            updatePrayerChart();
        }

        function updatePrayerChart() {
            const installDate = localStorage.getItem('installDate') || new Date().toISOString().split('T')[0];
            if (!localStorage.getItem('installDate')) {
                localStorage.setItem('installDate', installDate);
            }

            const today = new Date();
            const labels = [];
            const prayerData = [];

            // عرض آخر 10 أيام فقط (نافذة متحركة)
            for (let i = 9; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateString = date.toISOString().split('T')[0];
                labels.push(dateString);
                const count = parseInt(localStorage.getItem(`prayerCount_${dateString}`)) || 0;
                prayerData.push(count);
            }

            // ✅ حساب إجمالي آخر 10 أيام
            let last10Total = prayerData.reduce((a, b) => a + b, 0);
            document.getElementById("last10Total").innerText = last10Total;

            // ✅ حساب الإجمالي العام (كل البيانات المحفوظة)
            let overallTotal = 0;
            for (let key in localStorage) {
                if (key.startsWith("prayerCount_")) {
                    overallTotal += parseInt(localStorage.getItem(key)) || 0;
                }
            }
            document.getElementById("overallTotal").innerText = overallTotal;

            const ctx = document.getElementById('prayerChart').getContext('2d');
            if (window.prayerChartInstance) {
                window.prayerChartInstance.destroy();
            }

            window.prayerChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'عدد الصلوات',
                        data: prayerData,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1,
                                precision: 0,
                                callback: function (value) {
                                    return value;
                                }
                            },
                            title: { display: true, text: 'عدد الصلوات' }
                        },
                        x: {
                            title: { display: true, text: 'التاريخ' }
                        }
                    }
                }
            });
        }

        function showFullChart() {
            const ctx = document.getElementById('fullPrayerChart').getContext('2d');
            document.getElementById('fullChartContainer').style.display = 'block';

            // ✅ جمع كل البيانات المحفوظة (بدون حذف أي شيء)
            const allDates = [];
            for (let key in localStorage) {
                if (key.startsWith("prayerCount_")) {
                    const date = key.replace("prayerCount_", "");
                    allDates.push(date);
                }
            }

            // ترتيب التواريخ من الأقدم للأحدث
            allDates.sort();

            const labels = [];
            const data = [];

            allDates.forEach(dateString => {
                labels.push(dateString);
                const count = parseInt(localStorage.getItem(`prayerCount_${dateString}`)) || 0;
                data.push(count);
            });

            if (window.fullPrayerChartInstance) {
                window.fullPrayerChartInstance.destroy();
            }

            window.fullPrayerChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'عدد الصلوات (كامل)',
                        data: data,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1,
                                precision: 0
                            },
                            title: { display: true, text: 'عدد الصلوات' }
                        },
                        x: {
                            title: { display: true, text: 'التاريخ الكامل' }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            updatePrayerChart();

            // ✅ تحديث الرسم كل دقيقة تلقائيًا
            setInterval(() => {
                updatePrayerChart();
            }, 60 * 1000); // كل 60 ثانية

            ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'].forEach(prayer => {
                const btn = document.getElementById(`${prayer}-btn`);
                if (btn) {
                    const originalOnClick = btn.onclick;
                    btn.onclick = function () {
                        if (originalOnClick) originalOnClick.apply(this, arguments);
                        incrementPrayerCount(prayer);
                    };
                }
            });
        });

    </script>
    <!--<script>
        // إصدار التطبيق الحالي
        const CURRENT_APP_VERSION = '1.0.0';

        // تحقق من إصدار التطبيق عند تحميل الصفحة
        window.onload = function () {
            const storedVersion = localStorage.getItem('appVersion');
            const updateNotification = document.getElementById('updateNotification');

            // لو مفيش إصدار مخزّن (مستخدم جديد) أو الإصدار زي الحالي (محدّث)، نخفي الإشعار
            if (!storedVersion || storedVersion === CURRENT_APP_VERSION) {
                updateNotification.style.display = 'none';
            } else {
                // لو الإصدار قديم، نظهر الإشعار
                updateNotification.style.display = 'block';
            }
        };

        // دالة التحديث
        function updateApp() {
            // تحديث الإصدار في localStorage
            localStorage.setItem('appVersion', CURRENT_APP_VERSION);
            // إخفاء الإشعار
            document.getElementById('updateNotification').style.display = 'none';
            // إعادة تحميل الصفحة (أو تنفيذ عملية التحديث)
            window.location.reload();
        }

    </script>-->
    <!--<script>
        function incrementPrayerCount(prayer) {
            const today = new Date().toISOString().split('T')[0];
            const countKey = `prayerCount_${today}`;
            const prayerKey = `prayer_${prayer}_${today}`;

            // اجلب العدد الحالي
            let count = parseInt(localStorage.getItem(countKey)) || 0;

            // اجلب حالة الصلاة الحالية وتأكد إنها قيمة منطقية
            let currentStatus = localStorage.getItem(prayerKey);
            currentStatus = currentStatus && currentStatus.toLowerCase() === 'true';

            if (currentStatus) {
                // إذا كانت الصلاة مسجلة مسبقًا، نحذفها
                count = Math.max(count - 1, 0);
                localStorage.setItem(prayerKey, 'false');
            } else {
                // إذا لم تكن مسجلة، نضيفها
                count = Math.min(count + 1, 5);
                localStorage.setItem(prayerKey, 'true');
            }

            localStorage.setItem(countKey, count.toString());
            updatePrayerChart();
        }

        function updatePrayerChart() {
            const installDate = localStorage.getItem('installDate') || new Date().toISOString().split('T')[0];
            if (!localStorage.getItem('installDate')) {
                localStorage.setItem('installDate', installDate);
            }

            const today = new Date();
            const startDate = new Date(installDate);
            const labels = [];
            const prayerData = [];

            for (let i = 0; i < 10; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                const dateString = date.toISOString().split('T')[0];
                labels.push(dateString);
                const count = parseInt(localStorage.getItem(`prayerCount_${dateString}`)) || 0;
                prayerData.push(count);
            }

            const daysSinceInstall = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            if (daysSinceInstall >= 10) {
                const newStartDate = new Date(startDate);
                newStartDate.setDate(startDate.getDate() + 10);
                localStorage.setItem('installDate', newStartDate.toISOString().split('T')[0]);

                for (let i = 0; i < 10; i++) {
                    const oldDate = new Date(startDate);
                    oldDate.setDate(startDate.getDate() + i);
                    const oldKey = oldDate.toISOString().split('T')[0];
                    localStorage.removeItem(`prayerCount_${oldKey}`);
                    ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'].forEach(prayer => {
                        localStorage.removeItem(`prayer_${prayer}_${oldKey}`);
                    });
                }
            }

            const ctx = document.getElementById('prayerChart').getContext('2d');
            if (window.prayerChartInstance) {
                window.prayerChartInstance.destroy();
            }

            window.prayerChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'عدد الصلوات',
                        data: prayerData,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.2)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1,
                                precision: 0,
                                callback: function (value) {
                                    return value;
                                }
                            },
                            title: { display: true, text: 'عدد الصلوات' }
                        },
                        x: {
                            title: { display: true, text: 'التاريخ' }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            updatePrayerChart();

            ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'].forEach(prayer => {
                const btn = document.getElementById(`${prayer}-btn`);
                if (btn) {
                    const originalOnClick = btn.onclick;
                    btn.onclick = function () {
                        if (originalOnClick) originalOnClick.apply(this, arguments);
                        incrementPrayerCount(prayer);
                    };
                }
            });
        });
    </script>-->
    <!-- نافذة إدخال الاسم -->
    <!-- ✅ عناصر HTML -->
    <div id="namePrompt" class="overlay" style="display: none;">
        <div class="popup">
            <h2>مرحبًا بك في تطبيق "إني قريب" 🌿</h2>
            <p>نسعد بمعرفة اسمك لتقديم تجربة أقرب إليك 💚</p>
            <input type="text" id="userNameInput" placeholder="اكتب اسمك هنا..." />
            <div class="popup-buttons">
                <button id="saveBtn">تم</button>
                <button id="skipBtn">لاحقًا</button>
            </div>
        </div>
    </div>

    <div id="welcomeMessage" class="centered-welcome" style="display: none;"></div>
    <audio id="welcomeSound" src="https://cdn.pixabay.com/download/audio/2022/03/31/audio_a30f3b66b5.mp3?filename=notification-103027.mp3" preload="auto"></audio>

    <!-- ✅ ستايل -->
    <style>
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .popup {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 90%;
            width: 350px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

            .popup input {
                width: 100%;
                padding: 10px;
                margin-bottom: 20px;
                border-radius: 10px;
                border: 1px solid #ccc;
            }

        .popup-buttons button {
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            margin: 0 5px;
            cursor: pointer;
        }

            .popup-buttons button:first-child {
                background-color: #27ae60;
                color: white;
            }

            .popup-buttons button:last-child {
                background-color: #ccc;
                color: black;
            }

        .centered-welcome {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #2ecc71;
            color: white;
            padding: 20px 30px;
            border-radius: 20px;
            font-size: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            z-index: 9998;
            opacity: 0;
            transition: opacity 0.5s ease;
            text-align: center;
            max-width: 90%;
        }

            .centered-welcome.show {
                opacity: 1;
            }
    </style>

    <!-- ✅ سكربت -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import {
            getFirestore,
            doc,
            getDoc,
            setDoc
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyArzeIp8l9SyedrXck1VfGgoXxWm6sRtNQ",
            authDomain: "iqsreeb.firebaseapp.com",
            projectId: "iqsreeb",
            storageBucket: "iqsreeb.firebasestorage.app",
            messagingSenderId: "857287419802",
            appId: "1:857287419802:web:370efb40e2e4ef987e3c23",
            measurementId: "G-ZHNRKLQJPK"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function getDeviceId() {
            let id = localStorage.getItem("deviceId");
            if (!id) {
                id = crypto.randomUUID();
                localStorage.setItem("deviceId", id);
            }
            return id;
        }

        let welcomed = false;

        window.addEventListener("DOMContentLoaded", async () => {
            document.getElementById("saveBtn").addEventListener("click", saveUserName);
            document.getElementById("skipBtn").addEventListener("click", skipUserName);

            const deviceId = getDeviceId();
            const userRef = doc(db, "users", deviceId);

            try {
                const docSnap = await getDoc(userRef);
                const userData = docSnap.exists() ? docSnap.data() : null;
                const name = userData?.name;

                if (name && name.toLowerCase() !== "مجهول") {
                    localStorage.setItem("userName", name); // ✅ نحفظ الاسم من فايرستور
                    showWelcomeMessage(name);
                } else {
                    const localName = localStorage.getItem("userName");
                    if (localName && localName.toLowerCase() !== "مجهول") {
                        showWelcomeMessage(localName); // ✅ fallback عند عدم وجود اسم في الفاير
                    } else {
                        document.getElementById("namePrompt").style.display = "flex";
                    }
                }
            } catch (e) {
                console.warn("⚠️ فشل في الاتصال بـ Firebase:", e);
                const localName = localStorage.getItem("userName");
                if (localName && localName.toLowerCase() !== "مجهول") {
                    showWelcomeMessage(localName); // ✅ fallback عند فصل النت
                } else {
                    document.getElementById("namePrompt").style.display = "flex";
                }
            }
        });


        function saveUserName() {
            const input = document.getElementById("userNameInput").value.trim();
            if (/^[\u0600-\u06FFa-zA-Z ]{2,}$/.test(input) && input.toLowerCase() !== "مجهول") {
                const name = input;
                const deviceId = getDeviceId();
                const userRef = doc(db, "users", deviceId);

                setDoc(userRef, {
                    name,
                    deviceId,
                    lastVisit: new Date().toISOString(),
                }, { merge: true })
                    .then(() => {
                        localStorage.setItem("userName", name);
                        document.getElementById("namePrompt").style.display = "none";
                        showWelcomeMessage(name);
                        console.log("✅ تم حفظ الاسم الجديد في Firestore:", name);
                    })
                    .catch(e => {
                        console.error("❌ خطأ أثناء حفظ الاسم:", e);
                    });
            } else {
                alert("من فضلك اكتب اسمًا حقيقيًا ❤️");
            }
        }

        function skipUserName() {
            localStorage.setItem("userName", "مجهول");
            document.getElementById("namePrompt").style.display = "none";
        }

        function showWelcomeMessage(name) {
            if (welcomed) return;
            welcomed = true;

            const msg = document.getElementById("welcomeMessage");
            const sound = document.getElementById("welcomeSound");
            if (!msg || !sound) return;

            msg.textContent = `🎉 أهلًا يا ${name}!`;
            msg.style.display = "block";
            sound.play();
            confetti({ particleCount: 80, spread: 70, origin: { y: 0.6 } });

            setTimeout(() => msg.classList.add("show"), 50);
            setTimeout(() => {
                msg.classList.remove("show");
                setTimeout(() => msg.style.display = "none", 500);
            }, 3500);
        }
    </script>

    <!--per prey-->
    <!-- الصوت الخفيف -->
    <audio id="prayer-sound" src="https://cdn.pixabay.com/download/audio/2023/03/23/audio_5e13b90225.mp3?filename=success-1-6297.mp3" preload="auto"></audio>

    <script>
        function showSmallMessage(text) {
            const msg = document.createElement("div");
            msg.innerHTML = `  تمت صلاة ${text} بنجاح😍`;
            msg.className = "popup-message";
            document.body.appendChild(msg);

            // تشغيل الصوت
            const audio = document.getElementById("prayer-sound");
            if (audio) {
                audio.currentTime = 0;
                audio.play().catch(() => { });
            }

            // إظهار الرسالة
            setTimeout(() => {
                msg.classList.add("show");
            }, 10);

            // إخفاؤها بعد 2.5 ثانية
            setTimeout(() => {
                msg.classList.remove("show");
                setTimeout(() => msg.remove(), 300);
            }, 2500);
        }
    </script>

    <style>
        .popup-message {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background-color: #4caf50;
            color: white;
            padding: 16px 32px;
            border-radius: 16px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0,0,0,0.25);
            opacity: 0;
            pointer-events: none;
            transition: all 0.4s ease;
            z-index: 9999;
            font-family: 'Cairo', sans-serif;
            text-align: center;
        }

            .popup-message.show {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
    </style>

    <!--<script src="app.js"></script>-->


</body>
</html>
